<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#6200ee"><meta name="author" content="god23bin"><meta name="copyright" content="god23bin"><meta name="generator" content="Hexo 6.1.0"><meta name="theme" content="hexo-theme-yun"><title>æ·±å…¥æµ…å‡º1.7å’Œ1.8çš„HashMap | æ–¹åœ†-èµ·åå­—çœŸæ˜¯ä¸ªéš¾é¢˜</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.2.4/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/@unocss/runtime/mini.global.js"></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.min.js"></script><script>document.addEventListener("DOMContentLoaded", () => {
  Yun.utils.renderKatex();
});</script><link class="aplayer-style-marker" rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.css"><script class="aplayer-script-marker" src="https://cdn.jsdelivr.net/npm/aplayer@latest/dist/APlayer.min.js" defer></script><script class="meting-script-marker" src="https://cdn.jsdelivr.net/npm/meting@1/dist/Meting.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/pjax@latest/pjax.min.js" defer></script><script src="/js/pjax.js" defer type="module"></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script><link rel="icon" type="image/png" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#6200ee"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"god23bin.github.io","root":"/","title":["æ–¹åœ†","å¯æ–¹","å¯åœ†"],"version":"1.8.11","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]},"vendors":{"darken":"https://cdn.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="å‰è¨€HashMap æ˜¯æˆ‘ä»¬æœ€æœ€æœ€å¸¸ç”¨çš„ä¸œè¥¿äº†ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬åœ¨å¤§å­¦ä¸­å­¦ä¹ æ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œå­¦åˆ°çš„å“ˆå¸Œè¡¨è¿™ç§æ•°æ®ç»“æ„ã€‚é¢è¯•ä¸­ï¼ŒHashMap çš„é—®é¢˜ä¹Ÿæ˜¯å¸¸å®¢ï¼Œç°åœ¨å·åˆ°å¿…é¡»ç­”å‡ºæ¥äº†ï¼Œæ˜¯å¿…é¡»ä¼šçš„çŸ¥è¯†ã€‚ æˆ‘åœ¨å­¦ä¹  HashMap çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿé‡åˆ°äº†ä¸å°‘é—®é¢˜ï¼Œä»æ¦‚å¿µåˆ°ä½¿ç”¨ï¼Œæ•´ä¸ªè¿‡ç¨‹éƒ½å¤§å¤§å°å°æœ‰äº›ç–‘æƒ‘ï¼Œç„¶è€Œæˆ‘è¿™äº›ç–‘æƒ‘æ˜¯å› ä¸ºæˆ‘åœ¨æŸä¸ªçŸ¥è¯†ç¯èŠ‚ä¸Šå‡ºäº†é—®é¢˜ï¼Œå¯¼è‡´ä¸èƒ½ç†è§£ï¼Œå½“æˆ‘çœ‹äº†ç½‘ä¸Šå„ç§å…³äº HashMap çš„æœ‰å…³åšå®¢ä»¥åŠ">
<meta property="og:type" content="article">
<meta property="og:title" content="æ·±å…¥æµ…å‡º1.7å’Œ1.8çš„HashMap">
<meta property="og:url" content="https://god23bin.github.io/posts/shallow-in-java-with-hashmap/index.html">
<meta property="og:site_name" content="æ–¹åœ†-èµ·åå­—çœŸæ˜¯ä¸ªéš¾é¢˜">
<meta property="og:description" content="å‰è¨€HashMap æ˜¯æˆ‘ä»¬æœ€æœ€æœ€å¸¸ç”¨çš„ä¸œè¥¿äº†ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬åœ¨å¤§å­¦ä¸­å­¦ä¹ æ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œå­¦åˆ°çš„å“ˆå¸Œè¡¨è¿™ç§æ•°æ®ç»“æ„ã€‚é¢è¯•ä¸­ï¼ŒHashMap çš„é—®é¢˜ä¹Ÿæ˜¯å¸¸å®¢ï¼Œç°åœ¨å·åˆ°å¿…é¡»ç­”å‡ºæ¥äº†ï¼Œæ˜¯å¿…é¡»ä¼šçš„çŸ¥è¯†ã€‚ æˆ‘åœ¨å­¦ä¹  HashMap çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿé‡åˆ°äº†ä¸å°‘é—®é¢˜ï¼Œä»æ¦‚å¿µåˆ°ä½¿ç”¨ï¼Œæ•´ä¸ªè¿‡ç¨‹éƒ½å¤§å¤§å°å°æœ‰äº›ç–‘æƒ‘ï¼Œç„¶è€Œæˆ‘è¿™äº›ç–‘æƒ‘æ˜¯å› ä¸ºæˆ‘åœ¨æŸä¸ªçŸ¥è¯†ç¯èŠ‚ä¸Šå‡ºäº†é—®é¢˜ï¼Œå¯¼è‡´ä¸èƒ½ç†è§£ï¼Œå½“æˆ‘çœ‹äº†ç½‘ä¸Šå„ç§å…³äº HashMap çš„æœ‰å…³åšå®¢ä»¥åŠ">
<meta property="og:locale">
<meta property="og:image" content="https://pic-bed-of-god23bin.oss-cn-shenzhen.aliyuncs.com/img/20221030194819.png">
<meta property="og:image" content="https://pic-bed-of-god23bin.oss-cn-shenzhen.aliyuncs.com/img/20221030194830.png">
<meta property="og:image" content="https://pic-bed-of-god23bin.oss-cn-shenzhen.aliyuncs.com/img/20221030194843.jpg">
<meta property="og:image" content="https://pic-bed-of-god23bin.oss-cn-shenzhen.aliyuncs.com/img/20221030195148.png">
<meta property="article:published_time" content="2022-10-30T21:25:00.000Z">
<meta property="article:modified_time" content="2022-11-20T13:00:01.530Z">
<meta property="article:author" content="god23bin">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="HashMap">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic-bed-of-god23bin.oss-cn-shenzhen.aliyuncs.com/img/20221030194819.png"><script>(function() {
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info mickey-mouse"><a class="site-author-avatar" href="/about/" title="god23bin"><img width="96" loading="lazy" src="https://raw.githubusercontent.com/god23bin/pic-bed/master/img/20220516145418.jpeg" alt="god23bin"><span class="site-author-status" title="ä»Šå¤©ä¸å­¦ä¹ ï¼Œæ˜å¤©å˜åƒåœ¾">ğŸ˜†</span></a><div class="site-author-name"><a href="/about/">god23bin</a></div><a class="site-name" href="/about/site.html">æ–¹åœ†-èµ·åå­—çœŸæ˜¯ä¸ªéš¾é¢˜</a><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">30</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">9</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">34</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="æ–‡æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/god23bin" title="GitHub" target="_blank" style="color:#181717"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="god23bin@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=77844313" title="ç½‘æ˜“äº‘éŸ³ä¹" target="_blank" style="color:#C10D0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/341183781" title="å“”å“©å“”å“©åŠ¨ç”»" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="æˆ‘å–œæ¬¢çš„å¤§ä½¬ä»¬" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a><a class="links-item hty-icon-button" href="/girls/" title="æˆ‘çš„å¥³ç¥å¤©ä½¿ä»¬" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-women-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">å‰è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0-HashMap-%E4%B9%8B%E5%89%8D%EF%BC%8C%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-text">å­¦ä¹  HashMap ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%93%88%E5%B8%8C%E8%A1%A8%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8%E5%8F%AF%E4%BB%A5%E7%94%A8%E6%9D%A5%E5%B9%B2%E5%98%9B%EF%BC%9F"><span class="toc-text">å“ˆå¸Œè¡¨å¯ä»¥ç”¨æ¥å¹²å˜›ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE%EF%BC%9F"><span class="toc-text">å“ˆå¸Œè¡¨å¦‚ä½•å­˜å‚¨æ•°æ®ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%93%88%E5%B8%8C%E5%86%B2%E7%AA%81%EF%BC%9F"><span class="toc-text">ä»€ä¹ˆæ˜¯å“ˆå¸Œå†²çªï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%86%B2%E7%AA%81%EF%BC%9F"><span class="toc-text">å¦‚ä½•è§£å†³å†²çªï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%89%E9%93%BE%E6%B3%95"><span class="toc-text">æ‹‰é“¾æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%88%E5%B8%8C%E8%A1%A8%E6%9F%A5%E6%89%BE%E6%95%88%E7%8E%87"><span class="toc-text">å“ˆå¸Œè¡¨æŸ¥æ‰¾æ•ˆç‡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-7-%E7%89%88-HashMap"><span class="toc-text">1.7 ç‰ˆ HashMap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%8D%E6%AC%A1%E5%88%9D%E8%AF%86-1-7-%E7%9A%84-HashMap"><span class="toc-text">å†æ¬¡åˆè¯† 1.7 çš„ HashMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HashMap-%E4%B8%AD%E7%9A%84%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F"><span class="toc-text">HashMap ä¸­çš„æˆå‘˜å˜é‡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%B8%AA%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-text">4 ä¸ªæ„é€ æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B0%E5%8A%A8-x2F-%E5%93%88%E5%B8%8C%E5%87%BD%E6%95%B0"><span class="toc-text">æ‰°åŠ¨&#x2F;å“ˆå¸Œå‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%95%99%E4%B8%AA%E5%8D%B0%E8%B1%A1-indexFor"><span class="toc-text">ç•™ä¸ªå°è±¡-indexFor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#put-%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-text">put çš„è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#get-%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-text">get çš„è¿‡ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%89%A9%E5%AE%B9-resize-transfer"><span class="toc-text">è‡ªåŠ¨æ‰©å®¹-resize+transfer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-%E6%80%BB%E7%BB%93"><span class="toc-text">1.7 æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-8-%E7%89%88-HashMap"><span class="toc-text">1.8 ç‰ˆ HashMap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9C%8B%E7%9C%8B%E5%8C%BA%E5%88%AB"><span class="toc-text">çœ‹çœ‹åŒºåˆ«</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node"><span class="toc-text">Node</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B0%E5%8A%A8%E5%87%BD%E6%95%B0"><span class="toc-text">æ‰°åŠ¨å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-text">æ„é€ æ–¹æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#put-%E7%9A%84%E5%8F%98%E5%8C%96"><span class="toc-text">put çš„å˜åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#get-%E7%9A%84%E5%8F%98%E5%8C%96"><span class="toc-text">get çš„å˜åŒ–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9%E6%9C%BA%E5%88%B6"><span class="toc-text">æ‰©å®¹æœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%90%86%E8%A7%A3-e-hash-amp-oldCap-x3D-x3D-0"><span class="toc-text">ç†è§£ (e.hash &amp; oldCap) &#x3D;&#x3D; 0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E7%BA%A2%E9%BB%91%E6%A0%91"><span class="toc-text">å…³äºçº¢é»‘æ ‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-8-%E6%80%BB%E7%BB%93"><span class="toc-text">1.8 æ€»ç»“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD"><span class="toc-text">ç»“è¯­</span></a></li></ol></div></div></div><div class="tag-cloud"><div class="tag-cloud-tags"><a href="/tags/Ajax/" style="font-size: 12px; color: #999">Ajax</a> <a href="/tags/Android/" style="font-size: 16.5px; color: #7391ad">Android</a> <a href="/tags/C%E8%AF%AD%E8%A8%80/" style="font-size: 25.5px; color: #2680d4">Cè¯­è¨€</a> <a href="/tags/ES/" style="font-size: 12px; color: #999">ES</a> <a href="/tags/Element-UI/" style="font-size: 12px; color: #999">Element UI</a> <a href="/tags/HashMap/" style="font-size: 12px; color: #999">HashMap</a> <a href="/tags/Hexo/" style="font-size: 12px; color: #999">Hexo</a> <a href="/tags/Java/" style="font-size: 25.5px; color: #2680d4">Java</a> <a href="/tags/Js/" style="font-size: 12px; color: #999">Js</a> <a href="/tags/Json/" style="font-size: 12px; color: #999">Json</a> <a href="/tags/MySQL/" style="font-size: 12px; color: #999">MySQL</a> <a href="/tags/NLP/" style="font-size: 12px; color: #999">NLP</a> <a href="/tags/Node-js/" style="font-size: 12px; color: #999">Node.js</a> <a href="/tags/Spring/" style="font-size: 12px; color: #999">Spring</a> <a href="/tags/Vue-js/" style="font-size: 12px; color: #999">Vue.js</a> <a href="/tags/jQuery/" style="font-size: 12px; color: #999">jQuery</a> <a href="/tags/%E5%85%A5%E9%97%A8/" style="font-size: 25.5px; color: #2680d4">å…¥é—¨</a> <a href="/tags/%E5%87%BD%E6%95%B0%E5%AE%9E%E7%8E%B0/" style="font-size: 25.5px; color: #2680d4">å‡½æ•°å®ç°</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 30px; color: #0078e7">å‰ç«¯</a> <a href="/tags/%E5%90%8E%E7%AB%AF/" style="font-size: 21px; color: #4d89c0">åç«¯</a></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#6200ee;"><link itemprop="mainEntityOfPage" href="https://god23bin.github.io/posts/shallow-in-java-with-hashmap/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="god23bin"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="æ–¹åœ†-èµ·åå­—çœŸæ˜¯ä¸ªéš¾é¢˜"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">æ·±å…¥æµ…å‡º1.7å’Œ1.8çš„HashMap</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="Created: 2022-10-30 21:25:00" itemprop="dateCreated datePublished" datetime="2022-10-30T21:25:00+00:00">2022-10-30</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="Modified: 2022-11-20 13:00:01" itemprop="dateModified" datetime="2022-11-20T13:00:01+00:00">2022-11-20</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="Word count in article"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-file-word-line"></use></svg></span> <span title="Word count in article">12.2k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="Reading time"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-timer-line"></use></svg></span> <span title="Reading time">52m</span></span></span><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="Views"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/Java/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">Java</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/Java/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Java</span></a><a class="tag-item" href="/tags/HashMap/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">HashMap</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>HashMap æ˜¯æˆ‘ä»¬<strong>æœ€æœ€æœ€</strong>å¸¸ç”¨çš„ä¸œè¥¿äº†ï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬åœ¨å¤§å­¦ä¸­å­¦ä¹ æ•°æ®ç»“æ„çš„æ—¶å€™ï¼Œå­¦åˆ°çš„å“ˆå¸Œè¡¨è¿™ç§æ•°æ®ç»“æ„ã€‚é¢è¯•ä¸­ï¼ŒHashMap çš„é—®é¢˜ä¹Ÿæ˜¯å¸¸å®¢ï¼Œç°åœ¨å·åˆ°å¿…é¡»ç­”å‡ºæ¥äº†ï¼Œæ˜¯å¿…é¡»ä¼šçš„çŸ¥è¯†ã€‚</p>
<p>æˆ‘åœ¨å­¦ä¹  HashMap çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿé‡åˆ°äº†ä¸å°‘é—®é¢˜ï¼Œä»æ¦‚å¿µåˆ°ä½¿ç”¨ï¼Œæ•´ä¸ªè¿‡ç¨‹éƒ½å¤§å¤§å°å°æœ‰äº›ç–‘æƒ‘ï¼Œç„¶è€Œæˆ‘è¿™äº›ç–‘æƒ‘æ˜¯å› ä¸ºæˆ‘åœ¨æŸä¸ªçŸ¥è¯†ç¯èŠ‚ä¸Šå‡ºäº†é—®é¢˜ï¼Œå¯¼è‡´ä¸èƒ½ç†è§£ï¼Œå½“æˆ‘çœ‹äº†ç½‘ä¸Šå„ç§å…³äº HashMap çš„æœ‰å…³åšå®¢ä»¥åŠ HashMap çš„æºç åï¼Œå¤§è‡´æ˜¯ç†è§£äº†ï¼Œä½†æ˜¯æˆ‘åˆä¸ç¡®å®šæˆ‘æ˜¯å¦æ˜¯çœŸçš„ç†è§£äº†ï¼Œå†³å®šæŠŠ HashMap çš„åŸºæœ¬å¿…é¡»ä¼šçš„çŸ¥è¯†å…¨éƒ¨æ¢³ç†ä¸‹æ¥ï¼ŒåŠ¿å¿…å¾—æå®šå®ƒï¼</p>
<blockquote>
<p>ä»æœ€å¼€å§‹åªæ˜¯ä¼šä½¿ç”¨å®ƒçš„ API è¿›è¡Œæ•°æ®çš„å­˜å–ï¼Œåˆ°å†³å®šè¦æå®šç–‘æƒ‘ã€ææ‡‚å®ƒçš„åº•å±‚åŸç†ï¼</p>
</blockquote>
<p>æœ¬ç¯‡æ–‡ç« ï¼Œå°†ä» 0 æµ…å…¥ï¼Œä»ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨è®²èµ·ï¼Œç„¶åå†è¯´ Java æ˜¯æ€æ ·å®ç°å“ˆå¸Œè¡¨çš„ã€‚æ•´ä¸ªæ¢³ç†è¿‡ç¨‹ï¼Œå°†é€šè¿‡æºç è¿™ä¸ªç¬¬ä¸€æ‰‹çš„èµ„æ–™è¿›è¡Œæ¢³ç†åˆ†æï¼Œå¸æ”¶çŸ¥è¯†ã€è§£å†³ç–‘é—®ï¼Œä¸€æ­¥ä¸€æ­¥è¿›è¡Œæ¢³ç†ï¼Œå¦‚æœä½ æ˜¯å¯¹ HashMap æ‡µæ‡µæ‡‚æ‡‚çš„åŒå­¦ï¼Œé‚£ä¹ˆæ¬¢è¿è·Ÿç€æˆ‘çš„èŠ‚å¥ä¸€èµ·æ¥æ¢³ç†ï¼</p>
<p><strong>é˜…è¯»å®Œæœ¬ç¯‡æ–‡ç« ï¼Œä½ å°†æ”¶è·</strong>ï¼š</p>
<ul>
<li>è®¤è¯†å“ˆå¸Œè¡¨ã€å“ˆå¸Œå†²çªã€å†²çªè§£å†³æ–¹æ³•â€¦</li>
<li>æ˜ç™½ Java ä¸­å“ˆå¸Œè¡¨æ˜¯æ€æ ·å®ç°çš„â€¦</li>
<li>table æ•°ç»„çš„æ„æ€ã€å“ˆå¸Œæ¡¶çš„æ„æ€ã€Entry çš„æ„æ€ã€Node çš„æ„æ€â€¦</li>
<li>1.7 çš„ HashMap æºç åˆ†ææµç¨‹â€¦</li>
<li>æ˜ç™½ä¸ºä»€ä¹ˆå·²ç»æœ‰äº† hashCode() æ–¹æ³•äº†ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ hash() æ–¹æ³•</li>
<li>æ•´ä¸ª putã€getã€æ‰©å®¹çš„è¿‡ç¨‹â€¦</li>
<li>1.8 çš„ HashMap ä¸ 1.7 çš„ä¸åŒçš„åœ°æ–¹â€¦</li>
<li>1.8 çš„æ‰©å®¹å’Œ 1.7 çš„æ‰©å®¹ä¸ä¸€æ ·çš„åœ°æ–¹â€¦</li>
</ul>
<p>æ€»ä¹‹ï¼Œæˆ‘ç›¸ä¿¡å±å¹•å‰çš„ä½ è¯»å®Œè‚¯å®šæ˜¯æœ‰æ”¶è·çš„ï¼Œå½“ç„¶ï¼Œæœ€å¤§çš„æ”¶è·ç›®å‰æ˜¯æˆ‘è‡ªå·±å“ˆå“ˆå“ˆã€‚</p>
<p><strong>å…¨æ–‡1ä¸‡2000å¤šå­—ï¼Œæ¬¢è¿æ…¢æ…¢é£Ÿç”¨ï¼ç”±äºæœ¬äººæ°´å¹³æœ‰é™ï¼Œæ–‡ä¸­è‚¯å®šè¿˜æœ‰è®¸å¤šä¸è¶³ä¹‹å¤„ï¼Œæ¬¢è¿å¤§å®¶æŒ‡å‡ºï¼</strong></p>
<h2 id="å­¦ä¹ -HashMap-ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆï¼Ÿ"><a href="#å­¦ä¹ -HashMap-ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å­¦ä¹  HashMap ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆï¼Ÿ"></a>å­¦ä¹  HashMap ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆï¼Ÿ</h2><p>æˆ‘ä»¬çŸ¥é“ HashMap å°±æ˜¯ Java ä¸­å¯¹å“ˆå¸Œè¡¨è¿™ç§æ•°æ®ç»“æ„çš„å®ç°ï¼Œå€˜è‹¥ä½ ä¸çŸ¥é“ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ï¼Œé‚£ä¹ˆè‡ªç„¶å­¦ä¹  HashMap å°±ä¼šæœ‰å¤§å¤§çš„å›°éš¾ï¼Œå€˜è‹¥ä½ çŸ¥é“å“ˆå¸Œè¡¨ï¼Œä½†ä»…ä»…æ˜¯æ‡µæ‡µæ‡‚æ‡‚ï¼Œæœ‰ä¸ªç®€å•äº†è§£ï¼Œé‚£è‡ªç„¶å›°éš¾ä¼šé™ä½è®¸å¤šã€‚</p>
<p>æ‰€ä»¥ï¼Œåœ¨å­¦ä¹  HashMap ä¹‹å‰ï¼Œæˆ‘ä»¬è‡ªç„¶éœ€è¦å…ˆçŸ¥é“ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ï¼Œå½“ç„¶è¿˜éœ€è¦çŸ¥é“é“¾è¡¨ï¼Œä¸è¿‡æœ¬ç¯‡æ–‡ç« ä»…å¯¹å“ˆå¸Œè¡¨ä½œå‡ºè¯´æ˜ã€‚ä¸‹é¢å°†å¼€å§‹è®²è®²å“ˆå¸Œè¡¨è¿™ç§æŠ½è±¡çš„æ•°æ®ç»“æ„ï¼Œä¹‹æ‰€ä»¥è¯´æŠ½è±¡ï¼Œæ˜¯å› ä¸ºä¸‹é¢åªè¯´å“ˆå¸Œè¡¨åº”è¯¥å…·å¤‡çš„åŠŸèƒ½ï¼Œä½†æ˜¯ä¸ä¼šç»™å‡ºå…·ä½“å®ç°ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥ç®€å•åœ°ä½¿ç”¨æ•°ç»„æ¥å®ç°å“ˆå¸Œè¡¨ï¼Œæ˜¯å§ï¼Œä½†æ˜¯ Java ä¸­çš„å“ˆå¸Œè¡¨çš„å®ç°å°±ä¸æ˜¯å•å•ä¸€ä¸ªæ•°ç»„å°±å®ç°äº†çš„ã€‚</p>
<p>å¥½äº†ï¼ŒåºŸè¯å°‘è¯´ï¼Œå¼€æï¼</p>
<p><img src="https://pic-bed-of-god23bin.oss-cn-shenzhen.aliyuncs.com/img/20221030194819.png" alt="ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ï¼Ÿ" loading="lazy"></p>
<h2 id="ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨ï¼Ÿ</h2><p>å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼Œä¹Ÿæœ‰å¦ä¸€ä¸ªç§°å‘¼ï¼šæ•£åˆ—è¡¨ï¼‰ã€‚</p>
<p>å“ˆå¸Œè¡¨æ˜¯ä¸€ç§å¯ä»¥é€šè¿‡é”®ï¼ˆKeyï¼‰ç›´æ¥è®¿é—®å­˜å‚¨åœ¨æŸä¸ªä½ç½®ä¸Šçš„å€¼ï¼ˆValueï¼‰çš„æ•°æ®ç»“æ„ã€‚</p>
<p>Hash è¢«ç¿»è¯‘æˆã€Œå“ˆå¸Œã€ã€ã€Œæ•£åˆ—ã€ã€‚Key è¢«ç¿»è¯‘æˆã€Œé”®ã€ã€ã€Œå…³é”®å­—ã€</p>
<h3 id="å“ˆå¸Œè¡¨å¯ä»¥ç”¨æ¥å¹²å˜›ï¼Ÿ"><a href="#å“ˆå¸Œè¡¨å¯ä»¥ç”¨æ¥å¹²å˜›ï¼Ÿ" class="headerlink" title="å“ˆå¸Œè¡¨å¯ä»¥ç”¨æ¥å¹²å˜›ï¼Ÿ"></a>å“ˆå¸Œè¡¨å¯ä»¥ç”¨æ¥å¹²å˜›ï¼Ÿ</h3><p>å¾ˆç®€å•ï¼Œå’Œæˆ‘ä»¬ä»¥å‰å­¦ä¹ çš„æ•°æ®ç»“æ„ä¸€æ ·ï¼Œå¯ä»¥ç”¨æ¥å­˜å‚¨æ•°æ®ã€‚</p>
<p>è¿™ä¸æ˜¯åºŸè¯å˜›ï¼Ÿç¡®å®æ˜¯åºŸè¯ã€‚</p>
<p>å¥½å§ï¼Œé‚£ä¹ˆéƒ½å¯ä»¥å­˜å‚¨æ•°æ®ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šå‡ºç°å“ˆå¸Œè¡¨ï¼Ÿç›´æ¥ç”¨ä»¥å‰çš„é¡ºåºè¡¨ã€é“¾è¡¨ã€æ ˆã€é˜Ÿåˆ—ï¼Œè¿™äº›æ•°æ®ç»“æ„æ¥å­˜å‚¨ä¸è¡Œå—ï¼Ÿè¿™ä¸ªé—®é¢˜é—®å¾—å¥½ï¼Œç¡®å®ï¼Œåæ­£éƒ½æ˜¯å­˜å‚¨ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å“ˆå¸Œè¡¨ï¼Ÿ</p>
<p>è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå°±å¾—è¯´è¯´ä¸ºä»€ä¹ˆè¦æœ‰æ•°æ®ç»“æ„äº†ï¼Œä¹‹æ‰€ä»¥éœ€è¦æ•°æ®ç»“æ„ï¼Œæœ‰ä¸€ä¸ªç›®çš„å°±æ˜¯ï¼šæ›´æœ‰æ•ˆåœ°è¿›è¡Œæ•°æ®çš„å­˜å‚¨ï¼Œä¸åŒçš„æ•°æ®ç»“æ„æœ‰ä¸åŒçš„ç‰¹æ€§ï¼Œé¡ºåºè¡¨å¯ä»¥é€šè¿‡ä¸‹æ ‡å¿«é€Ÿçš„æŸ¥æ‰¾å‡ºæ•°æ®ã€é“¾è¡¨å¯ä»¥ä¸éœ€è¦å ç”¨ä¸€æ•´ç‰‡è¿ç»­çš„å­˜å‚¨ç©ºé—´è¿›è¡Œå­˜å‚¨ç­‰ç­‰ã€‚å“ˆå¸Œè¡¨ä¹Ÿæ˜¯ä¸€æ ·ã€‚</p>
<h3 id="å“ˆå¸Œè¡¨å¦‚ä½•å­˜å‚¨æ•°æ®ï¼Ÿ"><a href="#å“ˆå¸Œè¡¨å¦‚ä½•å­˜å‚¨æ•°æ®ï¼Ÿ" class="headerlink" title="å“ˆå¸Œè¡¨å¦‚ä½•å­˜å‚¨æ•°æ®ï¼Ÿ"></a>å“ˆå¸Œè¡¨å¦‚ä½•å­˜å‚¨æ•°æ®ï¼Ÿ</h3><p>å“ˆå¸Œè¡¨å­˜å‚¨æ•°æ®ï¼Œç»™å®šä¸€ä¸ª Keyï¼Œå­˜å‚¨ä¸€ä¸ª Valueã€‚è¿™é‡Œå°±éœ€è¦ç”¨åˆ°ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ï¼ˆæ•£åˆ—å‡½æ•°ï¼‰ã€‚</p>
<p>ä»¥æ•°å­¦ä¸­çš„ã€Œå‡½æ•°ã€æ¥ç†è§£ï¼Œå°±æ˜¯æœ‰ä¸€ä¸ªå‡½æ•°æ˜¯è¿™æ ·çš„ $f(x) &#x3D; y$ï¼Œä¸€ä¸ª $x$ é€šè¿‡å‡½æ•° $f$ æ˜ å°„æˆå€¼ $y$ ã€‚</p>
<p>é‚£ä¹ˆå“ˆå¸Œå‡½æ•°ä¹Ÿå¯ä»¥è¿™æ ·ç†è§£ï¼š$hash(key) &#x3D; address$</p>
<p>å³é”®é€šè¿‡å“ˆå¸Œå‡½æ•°æ˜ å°„æˆäº†ä¸€ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€å¯ä»¥æ˜¯æ•°ç»„ä¸‹æ ‡ã€å†…å­˜åœ°å€ç­‰ã€‚</p>
<p>æ‰€ä»¥å‘¢ï¼Œå­˜å‚¨å°±æ˜¯ï¼Œé€šè¿‡å“ˆå¸Œå‡½æ•°ï¼ŒæŠŠ Key æ˜ å°„åˆ°æŸä¸ªåœ°å€ï¼Œç„¶åå°† Value å­˜å‚¨åˆ°è¿™ä¸ªåœ°å€ä¸Šã€‚</p>
<p>é‚£ä¹ˆå­˜å‚¨åå¦‚ä½•è·å–ï¼Œå¦‚ä½•æŸ¥æ‰¾åˆ°è¿™ä¸ª Value å‘¢ï¼Ÿè¿˜æ˜¯ä¸€æ ·ï¼Œé€šè¿‡å“ˆå¸Œå‡½æ•°è·å¾— Key æ˜ å°„çš„åœ°å€ï¼Œç„¶åä»è¿™ä¸ªåœ°å€å–å‡º Value ã€‚ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œåœ¨å“ˆå¸Œè¡¨ä¸­æŸ¥æ‰¾æ•°æ®ï¼ŒæŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦æ˜¯ $O(1)$ ã€‚</p>
<p>æ‰€è°“çš„ã€Œå“ˆå¸Œã€ï¼Œå°±æ˜¯ Key é€šè¿‡å“ˆå¸Œå‡½æ•°å¾—åˆ°ä¸€ä¸ªå‡½æ•°å€¼ï¼ˆå“ˆå¸Œå€¼ã€å“ˆå¸Œåœ°å€ï¼‰çš„è¿‡ç¨‹ã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯å“ˆå¸Œå†²çªï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯å“ˆå¸Œå†²çªï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯å“ˆå¸Œå†²çªï¼Ÿ"></a>ä»€ä¹ˆæ˜¯å“ˆå¸Œå†²çªï¼Ÿ</h3><p>åœ¨æ•°å­¦ä¸Šï¼Œå‡½æ•°çš„æ˜ å°„å¯ä»¥æ˜¯ä¸€å¯¹ä¸€ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šå¯¹ä¸€çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ª $x$ å¯ä»¥æ˜ å°„ä¸€ä¸ª $y$ ï¼Œä¹Ÿå¯ä»¥å¤šä¸ª $x$ æ˜ å°„åˆ°åŒä¸€ä¸ª $y$ ä¸Šã€‚</p>
<p>å“ˆå¸Œå‡½æ•°ä¹Ÿä¸€æ ·ï¼Œå®ƒæœ‰å¯èƒ½å‡ºç°å¤šå¯¹ä¸€çš„æƒ…å†µï¼Œå³å¤šä¸ªä¸åŒçš„ Keyï¼Œé€šè¿‡å“ˆå¸Œå‡½æ•°å¾—åˆ°åŒä¸€ä¸ªåœ°å€ï¼ˆå“ˆå¸Œå€¼ï¼‰ã€‚</p>
<p>è¿™å°±å‡ºç°é—®é¢˜äº†ï¼Œè¿™ç§æƒ…å†µï¼Œå°±ç§°ä¸ºã€Œå“ˆå¸Œå†²çªã€ã€‚</p>
<blockquote>
<p>å“ˆå¸Œå†²çªå®Œæ•´å®šä¹‰ï¼šå“ˆå¸Œå‡½æ•°å¯èƒ½æŠŠä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„ä¸åŒå…³é”®å­—æ˜ å°„åˆ°åŒä¸€ä¸ªåœ°å€ï¼Œè¿™ç§æƒ…å†µç§°ä¸ºå†²çªã€‚å‘ç”Ÿå†²çªçš„ä¸åŒå…³é”®å­—ç§°ä¸ºåŒä¹‰è¯ã€‚</p>
</blockquote>
<p>ä½ æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸¤ä¸ªä¸åŒçš„ Keyï¼Œæ¯”æ–¹è¯´ Key1 å’Œ Key2ï¼Œé€šè¿‡å“ˆå¸Œå‡½æ•°å¾—åˆ°åŒä¸€ä¸ªåœ°å€ï¼Œé‚£ä¹ˆä½ ä¸è§£å†³è¿™ä¸ªå†²çªï¼Œç›´æ¥è¿›è¡Œå­˜å‚¨ï¼Œé‚£ä¹ˆå°±æ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>Key1 å…ˆå­˜å‚¨ï¼ŒKey2 åå­˜å‚¨ï¼Œè‡ªç„¶åªä¿å­˜äº† Key2</li>
<li>Key2 å…ˆå­˜å‚¨ï¼ŒKey1 åå­˜å‚¨ï¼Œè‡ªç„¶åªä¿å­˜äº† Key1</li>
</ul>
<p>è¿™ç§æƒ…å†µæ˜¯æˆ‘ä»¬ä¸æƒ³çœ‹åˆ°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è§£å†³å†²çªã€‚</p>
<h3 id="å¦‚ä½•è§£å†³å†²çªï¼Ÿ"><a href="#å¦‚ä½•è§£å†³å†²çªï¼Ÿ" class="headerlink" title="å¦‚ä½•è§£å†³å†²çªï¼Ÿ"></a>å¦‚ä½•è§£å†³å†²çªï¼Ÿ</h3><p>åœ¨è§£å†³å†²çªä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡å‡å°‘å†²çªçš„å‘ç”Ÿï¼Œè¿™å°±éœ€è¦è®¾è®¡å¾—OKçš„å“ˆå¸Œå‡½æ•°ã€‚å½“ç„¶å†²çªæ˜¯å¿…ç„¶çš„ï¼Œæ˜¯é€ƒä¸æ‰çš„ï¼Œå½“æ•°æ®é‡å¤Ÿå¤šçš„æ—¶å€™ï¼Œå¿…ç„¶ä¼šå‘ç”Ÿå†²çªï¼Œæ‰€ä»¥å°±éœ€è¦è®¾è®¡å¥½è§£å†³å†²çªçš„æ–¹æ³•ã€‚</p>
<p>å“ˆå¸Œå‡½æ•°çš„è®¾è®¡æ³¨æ„ç‚¹ï¼š</p>
<ul>
<li>å‡½æ•°çš„å®šä¹‰åŸŸå¿…é¡»åŒ…å«æ‰€æœ‰çš„ Keyï¼Œå‡½æ•°çš„å€¼åŸŸå¿…é¡»åŒ…å«æ‰€æœ‰çš„ Valueã€‚å…¶ä¸­å€¼åŸŸæ˜¯è·Ÿå“ˆå¸Œè¡¨çš„å¤§å°æœ‰å…³çš„ã€‚</li>
<li>å‡½æ•°è®¡ç®—å‡ºæ¥çš„åœ°å€ï¼ˆå“ˆå¸Œå€¼ï¼‰åº”è¯¥èƒ½å¤Ÿå‡åŒ€åˆ†å¸ƒåœ¨å“ˆå¸Œè¡¨çš„å†…å­˜åœ°å€ç©ºé—´ä¸Šï¼Œä»è€Œå‡å°‘å†²çªçš„å‘ç”Ÿã€‚</li>
<li>å‡½æ•°èƒ½å¤Ÿç®€å•å°±ç®€å•å®ç°ï¼Œè¿™æ ·è®¡ç®—ä¼šå¾ˆå¿«ã€‚</li>
</ul>
<p>è§£å†³å†²çªçš„æ–¹æ³•ï¼š</p>
<p>è§£å†³å†²çªçš„æ€æƒ³å°±æ˜¯ä¸ºå†²çªçš„ Key æ‰¾ä¸‹ä¸€ä¸ªæ²¡æœ‰è¢«å ç”¨çš„åœ°å€ã€‚</p>
<ul>
<li>å¼€æ”¾å®šå€æ³•</li>
<li>æ‹‰é“¾æ³•</li>
</ul>
<p>è¿™é‡Œå°±åªè¯´è¿™ä¸ªæ‹‰é“¾æ³•ã€‚</p>
<h3 id="æ‹‰é“¾æ³•"><a href="#æ‹‰é“¾æ³•" class="headerlink" title="æ‹‰é“¾æ³•"></a>æ‹‰é“¾æ³•</h3><p>æŠŠæ‰€æœ‰å‘ç”Ÿå†²çªçš„ Key å­˜å‚¨åœ¨ä¸€ä¸ªçº¿æ€§é“¾è¡¨ä¸­ï¼Œè¿™ä¸ªé“¾è¡¨ç”± Key å“ˆå¸Œè¿‡åå¾—åˆ°çš„åœ°å€ï¼ˆå“ˆå¸Œåœ°å€ï¼‰å”¯ä¸€æ ‡è¯†ï¼Œè¿™å°±æ˜¯æ‹‰é“¾æ³•ï¼Œé€‚ç”¨äºç»å¸¸æ’å…¥å’Œåˆ é™¤çš„æƒ…å†µã€‚</p>
<h3 id="å“ˆå¸Œè¡¨æŸ¥æ‰¾æ•ˆç‡"><a href="#å“ˆå¸Œè¡¨æŸ¥æ‰¾æ•ˆç‡" class="headerlink" title="å“ˆå¸Œè¡¨æŸ¥æ‰¾æ•ˆç‡"></a>å“ˆå¸Œè¡¨æŸ¥æ‰¾æ•ˆç‡</h3><p>å¹³å‡æŸ¥æ‰¾é•¿åº¦ï¼ˆASL-Average Search Lengthï¼‰ï¼Œå¯è¡¡é‡å“ˆå¸Œè¡¨çš„æŸ¥æ‰¾æ•ˆç‡ã€‚</p>
<p>ASLä¾èµ–äºå“ˆå¸Œè¡¨çš„ã€Œè£…å¡«å› å­ï¼ˆè´Ÿè½½å› å­ï¼‰ã€<br>$$<br>è£…å¡«å› å­çš„å®šä¹‰ï¼šÎ± &#x3D; \frac{å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°}{å“ˆå¸Œè¡¨çš„é•¿åº¦}â€‹<br>$$<br>è£…å¡«å› å­è¶Šå¤§ï¼Œé‚£ä¹ˆå†²çªçš„å¯èƒ½å°±è¶Šå¤§ï¼Œåä¹‹äº¦ç„¶ã€‚</p>
<h2 id="1-7-ç‰ˆ-HashMap"><a href="#1-7-ç‰ˆ-HashMap" class="headerlink" title="1.7 ç‰ˆ HashMap"></a>1.7 ç‰ˆ HashMap</h2><p><img src="https://pic-bed-of-god23bin.oss-cn-shenzhen.aliyuncs.com/img/20221030194830.png" alt="1.7 çš„HashMap" loading="lazy"></p>
<p>ç°åœ¨çŸ¥é“ä»€ä¹ˆæ˜¯å“ˆå¸Œè¡¨äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±çœ‹çœ‹ Java ä¸­å¯¹å“ˆå¸Œè¡¨çš„å®ç°â€”â€”HashMap</p>
<h3 id="å†æ¬¡åˆè¯†-1-7-çš„-HashMap"><a href="#å†æ¬¡åˆè¯†-1-7-çš„-HashMap" class="headerlink" title="å†æ¬¡åˆè¯† 1.7 çš„ HashMap"></a>å†æ¬¡åˆè¯† 1.7 çš„ HashMap</h3><p>æˆ‘ä»¬å…ˆçœ‹çœ‹æ–‡æ¡£æ˜¯æ€æ ·è¯´çš„ï¼ŒåŒæ—¶æˆ‘è¿›è¡Œäº†å¤§ä½“çš„ç¿»è¯‘ã€‚ï¼ˆè¿™äº›è¯´æ˜å¯ä»¥ä»æºç çš„å¼€å¤´æ‰¾åˆ°ï¼‰</p>
<blockquote>
<p>Hash table based implementation of the <code>Map</code> interface. This implementation provides all of the optional map operations, and permits <code>null</code> values and the <code>null</code> key. (The <code>HashMap</code> class is roughly equivalent to <code>Hashtable</code>, except that it is unsynchronized and permits nulls.) This class makes no guarantees as to the order of the map; in particular, it does not guarantee that the order will remain constant over time.</p>
</blockquote>
<p>å“ˆå¸Œè¡¨æ˜¯é€šè¿‡å®ç° Map æ¥å£å®ç°çš„ï¼Œå› ä¸º Map æ¥å£æä¾›äº†æ‰€æœ‰çš„æ˜ å°„æ“ä½œï¼Œ<strong>å¹¶ä¸”å…è®¸ç©ºå€¼å’Œç©ºé”®</strong>ï¼ˆHashMapè¿™ä¸ªç±»å¯ä»¥ç®€å•çš„çœ‹ä½œæ˜¯ HashTable ç±»ï¼Œä¸ä¹‹ä¸åŒæ˜¯ï¼ŒHashMap æ˜¯<strong>éåŒæ­¥ä¸”å…è®¸å­˜å‚¨ç©ºæ•°æ®çš„</strong>ï¼‰ã€‚HashMap è¿™ä¸ªç±»<strong>ä¸ä¿è¯æ˜ å°„çš„é¡ºåº</strong>ï¼Œç‰¹åˆ«æ˜¯ä¸ä¿è¯è¿™ä¸ªé¡ºåºä¼šéšç€æ—¶é—´çš„æ”¹å˜è€Œä¿æŒä¸å˜ã€‚</p>
<blockquote>
<p>This implementation provides constant-time performance for the basic operations (<code>get</code> and <code>put</code>), assuming the hash function disperses the elements properly among the buckets. Iteration over collection views requires time proportional to the â€œcapacityâ€ of the <code>HashMap</code> instance (the number of buckets) plus its size (the number of key-value mappings). Thus, itâ€™s very important not to set the initial capacity too high (or the load factor too low) if iteration performance is important.</p>
</blockquote>
<p>å½“å“ˆå¸Œå‡½æ•°æ°å½“åœ°å°†å…ƒç´ æ˜ å°„åˆ°å“ˆå¸Œæ¡¶ï¼ˆthe bucketsï¼‰ä¸­ï¼Œé‚£ä¹ˆå°±å…·æœ‰å¸¸é‡æ—¶é—´é‡Œçš„åŸºæœ¬æ“ä½œï¼ˆget å’Œ putï¼‰æ€§èƒ½ã€‚éå† HashMap è¿™ä¸ªé›†åˆçš„æ—¶å€™ï¼Œ<strong>éå†çš„æ—¶é—´ä¸ HashMap å®ä¾‹çš„å®¹é‡ï¼ˆå“ˆå¸Œæ¡¶çš„æ•°é‡ï¼‰åŠ ä¸Šå®ƒçš„å¤§å°ï¼ˆKeyå’ŒValueçš„æ˜ å°„æ•°é‡ï¼Œå³é”®å€¼å¯¹çš„æ•°é‡ï¼‰æˆæ­£æ¯”</strong>ï¼Œå› æ­¤ï¼Œä¸è¦è®¾ç½®åˆå§‹çš„å®¹é‡å¤ªé«˜ï¼Œæˆ–è€…è´Ÿè½½å› å­å¤ªä½ï¼Œè¿™æ˜¯éå¸¸é‡è¦çš„ã€‚</p>
<blockquote>
<p>An instance of <code>HashMap</code> has two parameters that affect its performance: <em>initial capacity</em> and <em>load factor</em>. The <em>capacity</em> is the number of buckets in the hash table, and the initial capacity is simply the capacity at the time the hash table is created. The <em>load factor</em> is a measure of how full the hash table is allowed to get before its capacity is automatically increased. When the number of entries in the hash table exceeds the product of the load factor and the current capacity, the hash table is <em>rehashed</em> (that is, internal data structures are rebuilt) so that the hash table has approximately twice the number of buckets.</p>
</blockquote>
<p>HashMap çš„å®ä¾‹ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ä¼šå½±å“å®ƒçš„æ€§èƒ½ï¼š<strong>åˆå§‹å®¹é‡</strong>å’Œ<strong>è´Ÿè½½å› å­</strong>ã€‚</p>
<p>åˆå§‹å®¹é‡å°±æ˜¯å“ˆå¸Œè¡¨ä¸­çš„å“ˆå¸Œæ¡¶çš„æ•°é‡ï¼Œæ‰€è°“å“ˆå¸Œæ¡¶ï¼Œå°±æ˜¯ä¸€ä¸ªä¸ªçš„æ•°ç»„å…ƒç´ æ‰€å çš„å‘ä½ï¼Œæˆ‘ä»¬å¯ä»¥ç§°æ•´ä¸ªæ•°ç»„ä¸º table æ•°ç»„ï¼Œç„¶åé‡Œé¢çš„ä¸€ä¸ªä¸ªå…ƒç´ ä½ç½®ï¼ˆtable[i]ï¼‰å°±æ˜¯å“ˆå¸Œæ¡¶ã€‚ä½ ç»™å®šä¸€ä¸ªåˆå§‹å®¹é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¹é‡å°±ä¼šåœ¨ table æ•°ç»„åˆ›å»ºçš„æ—¶å€™ï¼Œä½œä¸ºè¿™ä¸ª table æ•°ç»„çš„å®¹é‡ï¼Œå³å…¶é•¿åº¦ã€å¤§å°ã€‚</p>
<p>è´Ÿè½½å› å­æ˜¯è¡¡é‡åœ¨å½“å‰ HashMap è‡ªåŠ¨æ‰©å®¹å‰ï¼Œæœ‰å¤šå°‘ä¸ªå“ˆå¸Œæ¡¶æ˜¯å¯ä»¥è¢«è·å–åˆ°çš„ã€‚<strong>å½“å“ˆå¸Œè¡¨ä¸­çš„ Entry å¯¹è±¡ï¼ˆé”®å€¼å¯¹ï¼‰çš„æ•°é‡è¶…è¿‡äº†è´Ÿè½½å› å­å’Œå½“å‰å®¹é‡çš„ä¹˜ç§¯æ—¶ï¼ˆload factor Ã— capacityï¼‰ï¼Œé‚£ä¹ˆå“ˆå¸Œè¡¨å°±ä¼šè¿›è¡Œé‡æ–°å“ˆå¸Œï¼ˆrehashedï¼Œé‡æ„æ•´ä¸ªå“ˆå¸Œè¡¨ï¼‰ï¼Œtable æ•°ç»„å°±å˜ä¸ºåŸæ¥çš„ä¸¤å€å¤§ï¼Œå³æ‰©å®¹ä¸¤å€</strong>ã€‚</p>
<blockquote>
<p>As a general rule, the default load factor (.75) offers a good tradeoff between time and space costs. Higher values decrease the space overhead but increase the lookup cost (reflected in most of the operations of the <code>HashMap</code> class, including <code>get</code> and <code>put</code>). The expected number of entries in the map and its load factor should be taken into account when setting its initial capacity, so as to minimize the number of rehash operations. If the initial capacity is greater than the maximum number of entries divided by the load factor, no rehash operations will ever occur.</p>
</blockquote>
<p>é€šå¸¸æ¥è¯´ï¼Œ<strong>é»˜è®¤çš„è´Ÿè½½å› å­æ˜¯ 0.75</strong>ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¹³è¡¡ï¼Œå¹³è¡¡äº†æ—¶é—´ä»¥åŠç©ºé—´ï¼Œè¿™ä¸ªå€¼è¿‡é«˜ï¼Œè™½ç„¶ä¼šé™ä½ç©ºé—´çš„å¼€é”€ï¼Œä½†æ˜¯ä¼šå¢åŠ æ›´å¤šçš„æ—¶é—´æ¥æŸ¥æ‰¾ã€‚å½“è®¾ç½® HashMap çš„åˆå§‹å®¹é‡æ—¶ï¼Œåº”è¯¥ã€‚è€ƒè™‘å¥½é¢„æœŸçš„ Entry æ•°é‡ä»¥åŠè´Ÿè½½å› å­ï¼Œä»¥æ­¤å‡å°‘ rehash çš„æ¬¡æ•°ã€‚å¦‚æœå“ˆå¸Œè¡¨çš„åˆå§‹å®¹é‡ï¼ˆtable æ•°ç»„çš„é•¿åº¦ï¼‰å¤§äº Entry æ•°é‡é™¤ä»¥è´Ÿè½½å› å­ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿ rehash æ“ä½œã€‚</p>
<blockquote>
<p>If many mappings are to be stored in a <code>HashMap</code> instance, creating it with a sufficiently large capacity will allow the mappings to be stored more efficiently than letting it perform automatic rehashing as needed to grow the table. Note that using many keys with the same <code>hashCode()</code> is a sure way to slow down performance of any hash table. To ameliorate impact, when keys are <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/lang/Comparable.html"><code>Comparable</code></a>, this class may use comparison order among keys to help break ties.</p>
</blockquote>
<p>å¦‚æœéœ€è¦ä½¿ç”¨ HashMap å®ä¾‹æ¥å­˜å‚¨è®¸å¤šçš„æ˜ å°„ï¼Œé‚£ä¹ˆå°±éœ€è¦åˆ›å»ºä¸€ä¸ªå¤Ÿå¤§å®¹é‡çš„ HashMap å®ä¾‹ï¼Œè¿™æ ·æ•ˆç‡æ˜¯æœ€å¤§çš„ï¼Œæ¯”èµ·ä½ æä¸€ä¸ªå°å®¹é‡çš„ HashMapï¼Œç„¶åè®©å®ƒè‡ªå·± rehashã€table æ•°ç»„ç¿»å€ã€‚æ³¨æ„ï¼Œä½¿ç”¨è®¸å¤šæœ‰ç€ç›¸åŒ hashCode() çš„ Key çš„è¯ï¼Œé‚£è‚¯å®šæ˜¯ä¼šé™ä½å“ˆå¸Œè¡¨çš„æ€§èƒ½çš„ï¼Œå› ä¸ºå†²çªå¤šäº†ï¼Œä¸ºäº†é™ä½è¿™ç§å½±å“ï¼Œå½“è¿™äº› Key æ˜¯å¯æ¯”è¾ƒçš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆå“ˆå¸Œè¡¨æ—§å¯ä»¥ä½¿ç”¨æ¯”è¾ƒçš„æ–¹å¼å»è§£å†³ã€‚</p>
<blockquote>
<p><strong>Note that this implementation is not synchronized.</strong> If multiple threads access a hash map concurrently, and at least one of the threads modifies the map structurally, it <em>must</em> be synchronized externally. (A structural modification is any operation that adds or deletes one or more mappings; merely changing the value associated with a key that an instance already contains is not a structural modification.) This is typically accomplished by synchronizing on some object that naturally encapsulates the map. If no such object exists, the map should be â€œwrappedâ€ using the <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/7/docs/api/java/util/Collections.html#synchronizedMap(java.util.Map)"><code>Collections.synchronizedMap</code></a> method. This is best done at creation time, to prevent accidental unsynchronized access to the map:</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Map</span> m <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">synchronizedMap</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</blockquote>
<p>ä¸Šé¢çš„æ„æ€å°±æ˜¯è¯´ï¼Œéœ€è¦<strong>æ³¨æ„ HashMap æ˜¯ä¸åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯éçº¿ç¨‹å®‰å…¨çš„</strong>ï¼Œåœ¨å¤šçº¿ç¨‹å¹¶å‘çš„æƒ…å†µä¸‹å¯¹ HashMap è¿›è¡Œæ“ä½œï¼ˆæ·»åŠ ã€åˆ é™¤ã€æ˜ å°„ï¼‰ï¼Œå°±ä¼šå‘ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œå¦‚æœæƒ³åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ä½¿ç”¨ HashMapï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>Collections.synchronizedMap</code> æ–¹æ³•å°†æ™®é€šçš„ HashMap åŒ…è£…æˆåŒæ­¥çš„ HashMapã€‚ä¸è¿‡ä¸æ¨èè¿™æ ·ä½¿ç”¨ï¼Œæˆ‘ä»¬<strong>æ¨èä½¿ç”¨ ConcurrentHashMap</strong>ã€‚</p>
<blockquote>
<p>The iterators returned by all of this classâ€™s â€œcollection view methodsâ€ are <em>fail-fast</em>: if the map is structurally modified at any time after the iterator is created, in any way except through the iteratorâ€™s own <code>remove</code> method, the iterator will throw a <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/7/docs/api/java/util/ConcurrentModificationException.html"><code>ConcurrentModificationException</code></a>. Thus, in the face of concurrent modification, the iterator fails quickly and cleanly, rather than risking arbitrary, non-deterministic behavior at an undetermined time in the future.</p>
</blockquote>
<p><strong>è¿­ä»£å™¨å¿«é€Ÿå¤±è´¥ï¼ˆfail-fastï¼‰</strong>ï¼šå¦‚æœ Map åœ¨è¿­ä»£å™¨è¿›è¡Œè¿­ä»£çš„æ—¶å€™ï¼ŒMap ä¸­çš„æ•°æ®è¢«ä¿®æ”¹äº†ï¼Œé‚£ä¹ˆè¿­ä»£å™¨å°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼š<code>ConcurrentModificationException</code>ã€‚å› ä¸ºæ€•æœ‰ä¸ç¡®å®šçš„è¡Œä¸ºé£é™©ï¼Œä¸»è¦æ¥è¯´å°±æ˜¯æ€•æ•°æ®ä¸ä¸€è‡´ï¼Œæ€•çº¿ç¨‹ä¸å®‰å…¨ã€‚</p>
<hr>
<p>çœ‹å®Œäº†æ–‡æ¡£çš„è¯´æ˜ï¼Œç°åœ¨å¯ä»¥çŸ¥é“ï¼ŒHashMap å¤§æ¦‚æœ‰è¿™æ ·çš„ä¸œè¥¿</p>
<ul>
<li>å“ˆå¸Œè¡¨çš„é”®å€¼å¯¹ï¼ˆEntryï¼‰æ˜¯å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º table çš„æ•°ç»„ä¸­çš„ã€‚Entry çš„è¯ï¼Œæ˜¯æŠŠ Keyã€Valueã€hash å€¼ï¼Œå°è£…ä¸º Entry å¯¹è±¡ã€‚</li>
<li>table æ•°ç»„é‡Œé¢çš„ä¸€ä¸ªä¸ªå…ƒç´ ä½ç½®ï¼ˆtable[i]ï¼‰å°±æ˜¯å“ˆå¸Œæ¡¶ã€‚</li>
<li>å“ˆå¸Œæ¡¶å­˜å‚¨çš„å°±æ˜¯ Entryï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªä¸ªçš„å“ˆå¸Œæ¡¶ï¼Œå­˜å‚¨ç€ä¸€ä¸ªä¸ªçš„ Entry å¯¹è±¡ã€‚</li>
<li>å“ˆå¸Œè¡¨çš„åˆå§‹å®¹é‡æŒ‡çš„å°±æ˜¯ table æ•°ç»„çš„é•¿åº¦ã€‚</li>
<li><strong>å“ˆå¸Œè¡¨çš„å®¹é‡</strong>æŒ‡çš„æ˜¯ table æ•°ç»„çš„é•¿åº¦ï¼›<strong>å“ˆå¸Œè¡¨çš„å¤§å°</strong>æŒ‡çš„æ˜¯ Key å’Œ Value æ˜ å°„çš„æ•°é‡ï¼Œå³é”®å€¼å¯¹çš„æ•°é‡ã€‚è¿™ä¸ªå¾ˆé‡è¦ï¼Œéœ€è¦ææ¸…æ¥šå“ˆå¸Œè¡¨çš„ã€Œå®¹é‡ã€å’Œã€Œå®¹é‡ã€ï¼Œåˆ«ææ··äº†ã€‚</li>
<li>å½“ <code>Entry å¯¹è±¡çš„æ•°é‡ &gt; load factor Ã— capacity</code> æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œtable æ•°ç»„æ‰©å®¹ä¸ºåŸæ¥çš„ä¸¤å€ã€‚</li>
<li>å“ˆå¸Œè¡¨æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚</li>
</ul>
<p>çœ‹åˆ°è¿™é‡Œï¼Œå¯èƒ½è¿˜æ˜¯æœ‰äº›æŠ½è±¡ï¼Œæ²¡äº‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹æºç ã€‚</p>
<h3 id="HashMap-ä¸­çš„æˆå‘˜å˜é‡"><a href="#HashMap-ä¸­çš„æˆå‘˜å˜é‡" class="headerlink" title="HashMap ä¸­çš„æˆå‘˜å˜é‡"></a>HashMap ä¸­çš„æˆå‘˜å˜é‡</h3><p>é¦–å…ˆå…ˆçœ‹çœ‹ HashMap å®šä¹‰çš„æˆå‘˜å˜é‡ï¼š</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
    <span class="token keyword">extends</span> <span class="token class-name">AbstractMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span>
    <span class="token keyword">implements</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">,</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span>
<span class="token punctuation">&#123;</span>
    <span class="token comment">/**
     * The default initial capacity - MUST be a power of two.
     * é»˜è®¤çš„åˆå§‹åŒ–å®¹é‡å¤§å°ä¸º16ï¼Œè¿™ä¸ªå¤§å°å¿…é¡»ä¸º2æ¬¡å¹‚
     */</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEFAULT_INITIAL_CAPACITY <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
    
    <span class="token comment">/**
     * The maximum capacity, used if a higher value is implicitly specified
     * by either of the constructors with arguments.
     * MUST be a power of two &lt;= 1&lt;&lt;30.
     * æœ€å¤§çš„å®¹é‡ï¼Œå¦‚æœä»»æ„å¸¦å‚æ„é€ å‡½æ•°ä¼ å…¥çš„å€¼å¤§äºè¿™ä¸ªæœ€å¤§å®¹é‡ï¼Œå°±ä½¿ç”¨è¿™ä¸ªæœ€å¤§å®¹é‡
     * 1 å·¦ç§» 30ä½ï¼Œå³ 2çš„30æ¬¡æ–¹
     */</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MAXIMUM_CAPACITY <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span>
    
    <span class="token comment">/**
     * The load factor used when none specified in constructor.
     * é»˜è®¤è´Ÿè½½å› å­ 0.75
     */</span>
    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">float</span> DEFAULT_LOAD_FACTOR <span class="token operator">=</span> <span class="token number">0.75f</span><span class="token punctuation">;</span>
    
    <span class="token comment">/**
     * The table, resized as necessary. Length MUST Always be a power of two.
     * table æ•°ç»„ï¼Œå¿…è¦æ—¶å°±å¯ä»¥é‡ç½®å¤§å°ï¼Œé•¿åº¦å¿…é¡»æ€»æ˜¯2æ¬¡å¹‚ï¼Œæ³¨æ„è¿™é‡Œçš„æ•°ç»„ç±»å‹çš„ Entry
     * Entry æ˜¯ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œä¸‹é¢å°±å¯ä»¥çœ‹åˆ°äº†
     */</span>
    <span class="token keyword">transient</span> <span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 
    <span class="token comment">/**
     * Entry ç±»ï¼Œä¸»è¦ä½œä¸ºä¸€ä¸ªå­˜å‚¨ Key å’Œ Value çš„èŠ‚ç‚¹ï¼ŒåŒæ—¶ä¿å­˜å½“å‰çš„é€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºæ¥çš„ hash
     * next æŒ‡é’ˆï¼Œä¸»è¦ç”¨äºå‘ç”Ÿå†²çªæ—¶ï¼Œä½¿ç”¨æ‹‰é“¾æ³•è§£å†³å†²çªï¼ŒæŒ‡å‘é“¾è¡¨ä¸‹ä¸€ä¸ª Entry èŠ‚ç‚¹çš„
     */</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">final</span> <span class="token class-name">K</span> key<span class="token punctuation">;</span>	 <span class="token comment">// é”®</span>
        <span class="token class-name">V</span> value<span class="token punctuation">;</span>		 <span class="token comment">// å€¼</span>
        <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">;</span> <span class="token comment">// æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ ï¼Œä»è€Œå½¢æˆè§£å†³å†²çªçš„é“¾è¡¨</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> hash<span class="token punctuation">;</span>  <span class="token comment">// å“ˆå¸Œå€¼</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">/**
     * The number of key-value mappings contained in this map.
     * size ä»£è¡¨çš„å°±æ˜¯å½“å‰å­˜å‚¨åœ¨ map ä¸­çš„ Key-Value æ˜ å°„çš„æ•°é‡ï¼Œå³ Entry çš„æ•°é‡
     */</span>
    <span class="token keyword">transient</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>
    
    <span class="token comment">/**
     * The next size value at which to resize (capacity * load factor).
     * @serial
     * table é‡ç½®å¤§å°çš„é˜ˆå€¼ï¼Œè¿™ä¸ªé˜ˆå€¼å°±æ˜¯ä¹‹å‰è¯´çš„ load factor * capacity
     */</span>
    <span class="token keyword">int</span> threshold<span class="token punctuation">;</span>
    
    <span class="token comment">/**
     * The load factor for the hash table.
     *
     * @serial
     * è´Ÿè½½å› å­
     */</span>
    <span class="token keyword">final</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">;</span>
    
     <span class="token comment">/**
     * The number of times this HashMap has been structurally modified
     * Structural modifications are those that change the number of mappings in
     * the HashMap or otherwise modify its internal structure (e.g.,
     * rehash).  This field is used to make iterators on Collection-views of
     * the HashMap fail-fast.  (See ConcurrentModificationException).
     * è¿™ä¸ªå˜é‡ä¸»è¦ä¸ fail-fast å¿«é€Ÿå¤±è´¥ æœ‰å…³ï¼Œåé¢å†è¯´ï¼Œå…ˆç•™ä¸ªå°è±¡ã€‚
     */</span>
    <span class="token keyword">transient</span> <span class="token keyword">int</span> modCount<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>æ‰€ä»¥è¯´ï¼Œåœ¨ JDK 1.7 åŠä»¥å‰ï¼ŒHashMap çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ã€Œæ•°ç»„+é“¾è¡¨ã€ï¼Œè¿™é‡Œçš„æ•°ç»„æŒ‡çš„å°±æ˜¯ Entry ç±»å‹çš„ table æ•°ç»„ï¼ŒåŒæ—¶ä½¿ç”¨ Entry ä½œä¸ºé“¾è¡¨çš„èŠ‚ç‚¹ã€‚</p>
<p>ä¸Šå›¾è¯´è¯ï¼</p>
<p><img src="https://pic-bed-of-god23bin.oss-cn-shenzhen.aliyuncs.com/img/20221030194843.jpg" alt="hashmap 1.7 ç¤ºæ„å›¾" loading="lazy"></p>
<h3 id="4-ä¸ªæ„é€ æ–¹æ³•"><a href="#4-ä¸ªæ„é€ æ–¹æ³•" class="headerlink" title="4 ä¸ªæ„é€ æ–¹æ³•"></a>4 ä¸ªæ„é€ æ–¹æ³•</h3><p>æ¥ä¸‹æ¥çœ‹çœ‹æ„é€ æ–¹æ³•ï¼ŒHashMap ä¸­æœ‰ 4 ä¸ªæ„é€ æ–¹æ³•ï¼ŒæŒ‰æºç ä¸­çš„å‡ºç°é¡ºåºå¦‚ä¸‹ï¼š</p>
<ul>
<li><code>public HashMap(int initialCapacity, float loadFactor) </code></li>
<li><code>public HashMap(int initialCapacity)</code></li>
<li><code>public HashMap()</code></li>
<li><code>public HashMap(Map&lt;? extends K, ? extends V&gt; m)</code></li>
</ul>
<p>ç¬¬ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªåˆå§‹å®¹é‡ï¼Œå¦ä¸€ä¸ªè´Ÿè½½å› å­ï¼Œå¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯æ„é€ ä¸€ä¸ªæœ‰ç€ç¡®åˆ‡åˆå§‹å®¹é‡å’Œç¡®åˆ‡è´Ÿè½½å› å­çš„ HashMap å®ä¾‹ï¼Œæºç æ˜¯è¿™æ ·çš„ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java">  <span class="token comment">/**
   * Constructs an empty &lt;tt>HashMap&lt;/tt> with the specified initial
   * capacity and load factor.
   * 
   * @param  initialCapacity the initial capacity
   * @param  loadFactor      the load factor
   * @throws IllegalArgumentException if the initial capacity is negative
   *         or the load factor is nonpositive
   */</span>
  <span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// ä¸‹é¢3ä¸ªifï¼Œæ˜¯ä¿è¯ä»£ç çš„å¥å£®æ€§ï¼Œä¸æ˜¯ä¸»è¦å†…å®¹</span>
      <span class="token comment">// åˆå§‹å®¹é‡å°äº0ï¼Œé‚£ä¹ˆæŠ›å‡ºéæ³•å‚æ•°å¼‚å¸¸</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal initial capacity: "</span> <span class="token operator">+</span>
                                             initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// åˆå§‹å®¹é‡å¤§äºæœ€å¤§å®¹é‡ï¼ˆ2^30ï¼‰ï¼Œç›´æ¥å°†2^30ä½œä¸ºåˆå§‹å®¹é‡</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">></span> MAXIMUM_CAPACITY<span class="token punctuation">)</span>
          initialCapacity <span class="token operator">=</span> MAXIMUM_CAPACITY<span class="token punctuation">;</span>
      <span class="token comment">// å¦‚æœè´Ÿè½½å› å­å°äºç­‰äº0ï¼Œæˆ–è€…è´Ÿè½½å› å­æœ‰é—®é¢˜ï¼ŒæŠ›å‡ºå¼‚å¸¸</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>loadFactor <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span>loadFactor<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal load factor: "</span> <span class="token operator">+</span>
                                             loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ä¸»è¦å†…å®¹åœ¨è¿™é‡Œ</span>
      <span class="token comment">// Find a power of 2 >= initialCapacity</span>
      <span class="token comment">// æ‰¾åˆ°ä¸€ä¸ªäºŒæ¬¡å¹‚çš„æ•°ï¼Œå¦‚æœå½“å‰è¾“å…¥çš„åˆå§‹å®¹é‡åˆšå¥½çš„äºŒæ¬¡å¹‚ï¼Œå°±ä¸ç”¨æ‰¾äº†</span>
      <span class="token keyword">int</span> capacity <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>capacity <span class="token operator">&lt;</span> initialCapacity<span class="token punctuation">)</span>
          capacity <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>

      <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> loadFactor<span class="token punctuation">;</span>				<span class="token comment">// åˆå§‹åŒ–ï¼Œèµ‹å€¼</span>
      threshold <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>capacity <span class="token operator">*</span> loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// è‡ªåŠ¨æ‰©å®¹çš„é˜ˆå€¼</span>
      table <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">[</span>capacity<span class="token punctuation">]</span><span class="token punctuation">;</span>				<span class="token comment">// åˆ›å»ºå¤§å°ä¸ºcapacityçš„Entryæ•°ç»„</span>
      <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// ä¸€ä¸ªç©ºæ–¹æ³•ï¼Œæœ‰ä»€ä¹ˆç”¨ï¼Ÿè¿™ä¸ªå…ˆä¸ç®¡ï¼Œä¹‹åå†è¯´ï¼Œç›®å‰çŸ¥é“ä¸Šé¢çš„å°±è¶³å¤Ÿäº†ã€‚</span>
  <span class="token punctuation">&#125;</span></code></pre>

<p>å®é™…ä¸Šï¼Œæå®šä¸Šé¢ç¬¬ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œåé¢çš„æ„é€ æ–¹æ³•å°±è½»è€Œæ˜“ä¸¾äº†ã€‚ç¬¬äºŒä¸ªæ„é€ æ–¹æ³•ï¼Œåªæ˜¯è¾“å…¥äº†ä¸€ä¸ªåˆå§‹åŒ–å®¹é‡ï¼Œç›´æ¥è°ƒç”¨ç¬¬ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œè€Œè´Ÿè½½å› å­å°±æ˜¯é»˜è®¤çš„ 0.75ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">this</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">,</span> DEFAULT_LOAD_FACTOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span></code></pre>

<p>ç¬¬ä¸‰ä¸ªæ— å‚çš„æ„é€ æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨é»˜è®¤ 0.75 çš„è´Ÿè½½å› å­ä»¥åŠé»˜è®¤çš„åˆå§‹åŒ–å®¹é‡ä¸º 16 çš„ Entry ç±»å‹çš„ table æ•°ç»„ã€‚ç„¶åé»˜è®¤çš„é˜ˆå€¼å°±æ˜¯ 0.75 Ã— 16 &#x3D; 12ï¼Œå³å½“ Entry ä¸ªæ•°è¶…è¿‡ 12ï¼Œå­˜å‚¨ç¬¬ 13 ä¸ª Entry çš„æ—¶å€™ï¼Œå°±ä¼šè¿›è¡Œ resizeã€rehashã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> DEFAULT_LOAD_FACTOR<span class="token punctuation">;</span>
       threshold <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>DEFAULT_INITIAL_CAPACITY <span class="token operator">*</span> DEFAULT_LOAD_FACTOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
       table <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">[</span>DEFAULT_INITIAL_CAPACITY<span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span></code></pre>

<p>ç¬¬å››ä¸ªæ„é€ æ–¹æ³•ï¼Œæ¥æ”¶ä¸€ä¸ªç¡®åˆ‡çš„ Mapï¼Œç”¨ HashMap åŒ…è£…è¿™ä¸ªç¡®åˆ‡çš„ Map</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Constructs a new &lt;tt>HashMap&lt;/tt> with the same mappings as the
 * specified &lt;tt>Map&lt;/tt>.  The &lt;tt>HashMap&lt;/tt> is created with
 * default load factor (0.75) and an initial capacity sufficient to
 * hold the mappings in the specified &lt;tt>Map&lt;/tt>.
 *
 * @param   m the map whose mappings are to be placed in this map
 * @throws  NullPointerException if the specified map is null
 */</span>
<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">V</span><span class="token punctuation">></span></span> m<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> DEFAULT_LOAD_FACTOR<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
                  DEFAULT_INITIAL_CAPACITY<span class="token punctuation">)</span><span class="token punctuation">,</span> DEFAULT_LOAD_FACTOR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">putAllForCreate</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>ä»¥ä¸Šï¼Œå°±æ˜¯ HashMap çš„ 4 ä¸ªæ„é€ æ–¹æ³•ï¼Œçœ‹æ¥è¿˜æ˜¯å¯ä»¥æå®šçš„å˜›ï¼</p>
<h3 id="æ‰°åŠ¨-x2F-å“ˆå¸Œå‡½æ•°"><a href="#æ‰°åŠ¨-x2F-å“ˆå¸Œå‡½æ•°" class="headerlink" title="æ‰°åŠ¨&#x2F;å“ˆå¸Œå‡½æ•°"></a>æ‰°åŠ¨&#x2F;å“ˆå¸Œå‡½æ•°</h3><p>æ¥ç€çœ‹æºç ï¼Œå‘ç°å°±æ˜¯ hash() äº†ã€‚<strong>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ Object ä¸­ï¼Œå·²ç»æœ‰ä¸€ä¸ª hashCode() æ–¹æ³•äº†ï¼Œè¿™ä¸ª hashCode() å¯ä»¥è¯´æ˜¯ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œé‚£ä¸ºä»€ä¹ˆåœ¨ HashMap ä¸­ï¼Œåˆè¿˜éœ€è¦å¦ä¸€ä¸ª hash() æ–¹æ³•å‘¢ï¼Ÿ</strong></p>
<p>åœ¨æºç æ³¨é‡Šé‡Œå·²ç»è¯´æ˜äº†ï¼Œå°±æ˜¯æŠµå¾¡ä½è´¨é‡çš„å“ˆå¸Œå‡½æ•°ï¼Œè®© hashCode() è®¡ç®—å‡ºæ¥çš„å“ˆå¸Œç å†æ¬¡æ‰°åŠ¨ï¼ˆå†æ¬¡å“ˆå¸Œï¼‰ï¼Œè¿™æ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸º HashMap ä½¿ç”¨äºŒæ¬¡å¹‚é•¿åº¦çš„ table æ•°ç»„ï¼Œä¸è¿›è¡Œå†æ¬¡å“ˆå¸Œçš„è¯ï¼Œå°±ä¼šé‡åˆ° hashCode åœ¨è¾ƒä½ä½æ²¡æœ‰å·®å¼‚çš„å†²çªï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨è¿™ä¸ª hash() æ–¹æ³•ã€‚æ€»è€Œè¨€ä¹‹ï¼Œå°±æ˜¯å†æ¬¡æ‰°åŠ¨ï¼Œé™ä½å†²çªå‘ç”Ÿçš„æ¦‚ç‡ã€‚</p>
<p><strong>æœ‰å°ä¼™ä¼´å¯èƒ½æœ‰ç–‘æƒ‘ï¼Œã€Œä½è´¨é‡çš„å“ˆå¸Œå‡½æ•°ã€ï¼ŸhashCode() ä¸æ˜¯ Java å›ºå®šå®ç°å¥½çš„å—ï¼Ÿä¸ºä»€ä¹ˆæ€•æœ‰ä½è´¨é‡çš„ hashCode() ?</strong></p>
<p>è¿™ä¸ªé—®é¢˜é—®å¾—å¥½ï¼Œå®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å‘ç° hashCode() æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼ˆNative Methodï¼‰</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">native</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>è¿™å°±æ„å‘³ç€ï¼ŒhashCode() å¹¶ä¸æ˜¯ç”± Java è¯­è¨€å®ç°çš„ï¼Œè€Œæ˜¯ç”± C æˆ– C++ è¿™äº›é Java è¯­è¨€æ˜¯å®ç°çš„ã€‚<strong>åŒä¸€ä¸ª native æ–¹æ³•ï¼Œå¦‚æœç”¨ä¸åŒçš„ JVM å»è°ƒç”¨ï¼Œé‚£ä¹ˆè¿è¡Œæ•ˆç‡å¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œå› ä¸ºä¸åŒçš„ JVM å¯¹äºæŸä¸ª native æ–¹æ³•éƒ½æœ‰è‡ªå·±çš„å®ç°ï¼Œæ‰€ä»¥æ‰éœ€è¦æ‰°åŠ¨å‡½æ•°è¿›è¡Œå†æ¬¡å“ˆå¸Œ</strong>ã€‚</p>
<p>hash() æ–¹æ³•ï¼ˆæ‰°åŠ¨å‡½æ•°ï¼‰ä¼ å…¥çš„å‚æ•°æ˜¯ Key çš„ hashCode() è®¡ç®—å‡ºæ¥çš„å“ˆå¸Œç ï¼ˆå€¼ï¼‰ï¼Œå°†è¿™ä¸ªå“ˆå¸Œç ç»è¿‡ hash() æ–¹æ³•å¾—åˆ°æœ€ç»ˆçš„ hash å€¼ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Applies a supplemental hash function to a given hashCode, which
 * defends against poor quality hash functions.  This is critical
 * because HashMap uses power-of-two length hash tables, that
 * otherwise encounter collisions for hashCodes that do not differ
 * in lower bits. Note: Null keys always map to hash 0, thus index 0.
 */</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// This function ensures that hashCodes that differ only by</span>
    <span class="token comment">// constant multiples at each bit position have a bounded</span>
    <span class="token comment">// number of collisions (approximately 8 at default load factor).</span>
    h <span class="token operator">^=</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> h <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="ç•™ä¸ªå°è±¡-indexFor"><a href="#ç•™ä¸ªå°è±¡-indexFor" class="headerlink" title="ç•™ä¸ªå°è±¡-indexFor"></a>ç•™ä¸ªå°è±¡-indexFor</h3><p><code>indexFor()</code> æ–¹æ³•ï¼Œ<code>å“ˆå¸Œå€¼</code>å’Œ<code>æ•°ç»„é•¿åº¦å‡ä¸€</code>è¿›è¡Œ<code>ä¸è¿ç®—</code>ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Returns index for hash code h.
 */</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">indexFor</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> h <span class="token operator">&amp;</span> <span class="token punctuation">(</span>length<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>è·å–å“ˆå¸Œè¡¨çš„å¤§å°ã€åˆ¤æ–­å“ˆå¸Œè¡¨æ˜¯å¦ä¸ºç©º</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Returns the number of key-value mappings in this map.
 *
 * @return the number of key-value mappings in this map
 */</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> size<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * Returns &lt;tt>true&lt;/tt> if this map contains no key-value mappings.
 *
 * @return &lt;tt>true&lt;/tt> if this map contains no key-value mappings
 */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="put-çš„è¿‡ç¨‹"><a href="#put-çš„è¿‡ç¨‹" class="headerlink" title="put çš„è¿‡ç¨‹"></a>put çš„è¿‡ç¨‹</h3><p>HashMap çš„ put() æ–¹æ³•ï¼š</p>
<ul>
<li><code>public V put(K key, V value)</code></li>
</ul>
<p>è¿™ä¸ªæ–¹æ³•å°±æ˜¯å°†æŸä¸ªç¡®åˆ‡çš„ Key ä¸ æŸä¸ªç¡®åˆ‡çš„ Value è”ç³»èµ·æ¥ï¼Œå­˜å‚¨åˆ°å“ˆå¸Œè¡¨ä¸­ï¼Œè¿™æ ·å®ƒä»¬ä¹‹é—´å°±å»ºç«‹èµ·æ˜ å°„çš„å…³ç³»äº†ã€‚</p>
<p>å¦‚æœå½“å‰å“ˆå¸Œè¡¨ä¸­æœ‰äº†è¿™ä¸ª Keyï¼Œé‚£ä¹ˆå°±ç”¨æ–°çš„ Value è¦†ç›–æ‰æ—§çš„ Valueã€‚</p>
<p>Key å’Œ Value å¯ä»¥æ˜¯ nullï¼Œåªèƒ½æœ‰ä¸€ä¸ª Key ä¸º nullï¼Œå¯ä»¥æœ‰å¤šä¸ª Value ä¸º nullã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java">   <span class="token comment">/**
    * Associates the specified value with the specified key in this map.
    * If the map previously contained a mapping for the key, the old
    * value is replaced.
    *
    * @param key key with which the specified value is to be associated
    * @param value value to be associated with the specified key
    * @return the previous value associated with &lt;tt>key&lt;/tt>, or
    *         &lt;tt>null&lt;/tt> if there was no mapping for &lt;tt>key&lt;/tt>.
    *         (A &lt;tt>null&lt;/tt> return can also indicate that the map
    *         previously associated &lt;tt>null&lt;/tt> with &lt;tt>key&lt;/tt>.)
    */</span>
   <span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
           <span class="token keyword">return</span> <span class="token function">putForNullKey</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">// å°† Key çš„ hashCode å†æ¬¡å“ˆå¸Œå¾—åˆ°æœ€ç»ˆçš„ hash å€¼</span>
       <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">// å°† hash å€¼ä¸æ•°ç»„é•¿åº¦å‡ä¸€è¿›è¡Œä¸è¿ç®—ï¼Œè®¡ç®—æœ€ç»ˆçš„å“ˆå¸Œåœ°å€ï¼ˆå³æ•°ç»„ä¸‹æ ‡ï¼‰</span>
       <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token comment">// for å¾ªç¯æ˜¯éå†è¿™ä¸ªå“ˆå¸Œæ¡¶ä¸Šçš„é“¾è¡¨ï¼Œå¦‚æœæœ‰é“¾è¡¨çš„è¯ï¼Œå³ e.next != null è¯´æ˜æœ‰é“¾è¡¨äº†</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
           <span class="token class-name">Object</span> k<span class="token punctuation">;</span>
           <span class="token comment">// å¦‚æœè¯¥ä½ç½®çš„ hash å€¼å’Œå½“å‰è¦å­˜å‚¨çš„ Key çš„ hash å€¼ä¸€æ ·ï¼Œè¯´æ˜å¯èƒ½æ˜¯åŒä¸€ Key æˆ–ä¸åŒçš„ Key</span>
           <span class="token comment">// åŒä¸€ Key çš„è¯å°±å¯ä»¥è¦†ç›–ï¼Œä¸åŒ Key çš„è¯å°±éœ€è¦è§£å†³è¿™ä¸ªå†²çª</span>
           <span class="token comment">// å…ˆæ˜¯æ¯”è¾ƒå†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœå†…å­˜åœ°å€ä¸ç›¸ç­‰ï¼Œå†å»ä½¿ç”¨ equals æ–¹æ³•åˆ¤æ–­ä¸¤ä¸ª Key æ˜¯ä¸æ˜¯åŒä¸€ä¸ªã€‚</span>
           <span class="token comment">// å¦‚æœå†…å­˜åœ°å€ç›¸ç­‰ï¼Œè¯´æ˜æ˜¯åŒä¸€ä¸ª Key äº†ï¼Œä¸å¿…ä½¿ç”¨ equals äº†</span>
           <span class="token comment">// equals åˆ¤æ–­æ˜¯ç›¸ç­‰çš„è¯ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯åŒä¸€ä¸ª Key äº†ï¼Œå› ä¸º hashCode ç›¸ç­‰ä¸èƒ½è¯´æ˜ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰</span>
           <span class="token comment">// ä½†ä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰çš„è¯ï¼Œé‚£ä¹ˆ equals ä¸€å®šç›¸ç­‰ã€‚</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
               <span class="token comment">// è¿›å…¥è¿™é‡Œï¼Œè¯´æ˜æ˜¯åŒä¸€ä¸ª Keyï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”¨æ–° Value è¦†ç›–æ‰æ—§ Value äº†</span>
               <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
               e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
               e<span class="token punctuation">.</span><span class="token function">recordAccess</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// è¿™ä¸ªå…ˆä¸ç®¡</span>
               <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
           <span class="token punctuation">&#125;</span>
       <span class="token punctuation">&#125;</span>
	<span class="token comment">// èµ°åˆ°è¿™é‡Œï¼Œè¯´æ˜ Map ä¸­æ²¡æœ‰è¿™ä¸ª Keyï¼Œé‚£ä¹ˆå°±å¯ä»¥æ·»åŠ è¿™ä¸ª Key-Value çš„æ˜ å°„äº†</span>
       modCount<span class="token operator">++</span><span class="token punctuation">;</span>	<span class="token comment">// è¯´æ˜æ•°æ®å‘ç”Ÿäº†æ”¹å˜ï¼Œfail-fast ä¼šç”¨åˆ°</span>
       <span class="token function">addEntry</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// æ·»åŠ è¿™ä¸ªEntry</span>
       <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>

   <span class="token comment">/**
    * Offloaded version of put for null keys
    */</span>
   <span class="token keyword">private</span> <span class="token class-name">V</span> <span class="token function">putForNullKey</span><span class="token punctuation">(</span><span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token comment">// åˆ¤æ–­æœ‰æ²¡æœ‰è¿™ä¸ª null Keyï¼Œæœ‰å°±æ–°çš„ Value è¦†ç›–æ—§çš„ Value</span>
       <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
               <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
               e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
               e<span class="token punctuation">.</span><span class="token function">recordAccess</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
           <span class="token punctuation">&#125;</span>
       <span class="token punctuation">&#125;</span>
       <span class="token comment">// æ²¡æœ‰ï¼Œé‚£ä¹ˆå°±æ·»åŠ ä¸Šè¿™ä¸ª Key ä¸º null çš„æ˜ å°„</span>
       modCount<span class="token operator">++</span><span class="token punctuation">;</span>
       <span class="token function">addEntry</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>

<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">/**
        * This method is invoked whenever the value in an entry is
        * overwritten by an invocation of put(k,v) for a key k that's already
        * in the HashMap.
        */</span>
       <span class="token keyword">void</span> <span class="token function">recordAccess</span><span class="token punctuation">(</span><span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> m<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token punctuation">&#125;</span>       
       
   <span class="token punctuation">&#125;</span>
</code></pre>

<p>æ‰€ä»¥ï¼Œæ•´ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<p>å°† Key çš„ hashCode <strong>å†æ¬¡å“ˆå¸Œ</strong>å¾—åˆ°æœ€ç»ˆçš„ hash å€¼ï¼Œç„¶åé€šè¿‡è¿™ä¸ª hash å€¼ä¸æ•°ç»„é•¿åº¦å‡ä¸€è¿›è¡Œ<strong>ä¸è¿ç®—</strong>ï¼Œè®¡ç®—æœ€ç»ˆçš„å“ˆå¸Œåœ°å€ï¼Œæ¥ç€å°±éå†è¿™ä¸ªå“ˆå¸Œæ¡¶ï¼ˆå¦‚æœè¿™ä¸ªæ¡¶ä¸Šæœ‰é“¾è¡¨çš„è¯ï¼Œå¦‚æœè¿™ä¸ªå“ˆå¸Œæ¡¶æ²¡æœ‰å­˜å‚¨å…ƒç´ ï¼Œé‚£ä¹ˆç›´æ¥å­˜å‚¨åˆ°å½“å‰å“ˆå¸Œæ¡¶ï¼‰ï¼Œåˆ¤æ–­è¯¥ä½ç½®çš„ hash å€¼å’Œå½“å‰è¦å­˜å‚¨çš„ Key çš„ hash å€¼æ˜¯å¦ä¸€æ ·ï¼š</p>
<ul>
<li>ä¸€æ ·è¯´æ˜æ˜¯åŒä¸€ä¸ª Keyï¼Œåˆ™å¯ä»¥è¦†ç›–</li>
<li>ä¸ä¸€æ ·è¯´æ˜ä¸åŒ Keyï¼Œå‘ç”Ÿå“ˆå¸Œå†²çªï¼Œéœ€è¦è§£å†³å“ˆå¸Œå†²çªï¼Œé‚£ä¹ˆå…ˆæ˜¯æ¯”è¾ƒè¿™ä¸¤ä¸ª Key çš„å†…å­˜åœ°å€æ˜¯å¦ç›¸ç­‰ï¼š<ul>
<li>å¦‚æœå†…å­˜åœ°å€ä¸ç›¸ç­‰ï¼Œå†å»ä½¿ç”¨ equals æ–¹æ³•åˆ¤æ–­ä¸¤ä¸ª Key æ˜¯ä¸æ˜¯åŒä¸€ä¸ªã€‚<ul>
<li>equals åˆ¤æ–­ä¸¤ä¸ª Key ä¸º trueï¼Œç›´æ¥æ–° Value è¦†ç›–æ—§ Valueã€‚</li>
<li>equals åˆ¤æ–­ä¸¤ä¸ª Key ä¸º falseï¼Œå¦‚æœå½“å‰å“ˆå¸Œæ¡¶æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œå¾ªç¯åˆ¤æ–­ã€‚å¦‚æœåœ¨å½“å‰é“¾è¡¨èŠ‚ç‚¹ä¸€ç›´åˆ¤æ–­å‡º falseï¼Œåˆ™å°†è¿™ä¸ª Key å°è£…æˆ Entryï¼Œå¤´æ’æ³•æ’å…¥è¯¥é“¾è¡¨ã€‚</li>
</ul>
</li>
<li>å¦‚æœå†…å­˜åœ°å€ç›¸ç­‰ï¼Œè¯´æ˜æ˜¯åŒä¸€ä¸ª Key äº†ï¼Œä¸å¿…ä½¿ç”¨ equals äº†ï¼Œæ­¤æ—¶ç›´æ¥æ–° Value è¦†ç›–æ—§ Valueã€‚</li>
</ul>
</li>
</ul>
<p>é‚£ä¹ˆåˆ°è¿™é‡Œï¼Œæˆ‘ç›¸ä¿¡ä½ å·²ç»çœ‹æ‡‚äº† put çš„è¿‡ç¨‹äº†ï¼</p>
<h3 id="get-çš„è¿‡ç¨‹"><a href="#get-çš„è¿‡ç¨‹" class="headerlink" title="get çš„è¿‡ç¨‹"></a>get çš„è¿‡ç¨‹</h3><p>HashMap çš„ get() æ–¹æ³•ï¼š</p>
<ul>
<li><code>public V get(Object key)</code></li>
</ul>
<p>å¦‚æœ HashMap ä¸­æœ‰è¿™ä¸ª Keyï¼Œé‚£ä¹ˆå°±è¿”å›è¿™ä¸ª Key æ˜ å°„çš„ Valueã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Returns the value to which the specified key is mapped,
 * or &#123;@code null&#125; if this map contains no mapping for the key.
 *
 * &lt;p>More formally, if this map contains a mapping from a key
 * &#123;@code k&#125; to a value &#123;@code v&#125; such that &#123;@code (key==null ? k==null :
 * key.equals(k))&#125;, then this method returns &#123;@code v&#125;; otherwise
 * it returns &#123;@code null&#125;.  (There can be at most one such mapping.)
 *
 * &lt;p>A return value of &#123;@code null&#125; does not &lt;i>necessarily&lt;/i>
 * indicate that the map contains no mapping for the key; it's also
 * possible that the map explicitly maps the key to &#123;@code null&#125;.
 * The &#123;@link #containsKey containsKey&#125; operation may be used to
 * distinguish these two cases.
 *
 * @see #put(Object, Object)
 */</span>
<span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">getForNullKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å°† Key çš„ hashCode å†æ¬¡å“ˆå¸Œå¾—åˆ°æœ€ç»ˆçš„ hash å€¼</span>
    <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// indexFor(hash, table.length) è·å– Key æ‰€åœ¨ table æ•°ç»„ä¸­çš„ä¸‹æ ‡</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span><span class="token function">indexFor</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
         e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
         e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// for å¾ªç¯æ˜¯éå†è¿™ä¸ªå“ˆå¸Œæ¡¶ä¸Šçš„é“¾è¡¨ï¼Œå¦‚æœæœ‰é“¾è¡¨çš„è¯</span>
        <span class="token class-name">Object</span> k<span class="token punctuation">;</span>
        <span class="token comment">// åˆ¤æ–­è¯¥ä½ç½®ä¸Šçš„ Key æ˜¯å¦ä¸ºæˆ‘ä»¬éœ€è¦çš„ Key</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>ç›¸ä¿¡ä½ ææ‡‚äº† put çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆ get çš„è¿‡ç¨‹ä¹Ÿä¸éš¾ç†è§£ï¼Œè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<p>å°† Key çš„ hashCode <strong>å†æ¬¡å“ˆå¸Œ</strong>å¾—åˆ°æœ€ç»ˆçš„ hash å€¼ï¼Œç„¶åé€šè¿‡è¿™ä¸ª hash å€¼ä¸æ•°ç»„é•¿åº¦å‡ä¸€è¿›è¡Œ<strong>ä¸è¿ç®—</strong>ï¼Œè®¡ç®—æœ€ç»ˆçš„å“ˆå¸Œåœ°å€ï¼ˆè¢«å°è£…æˆ <code>indexFor</code> æ–¹æ³•äº†ï¼‰ï¼Œæ¥ç€è¿˜æ˜¯ä¸€æ ·ï¼Œéå†å“ˆå¸Œæ¡¶ï¼Œåˆ¤æ–­è¯¥ä½ç½®ä¸Šçš„ Key æ˜¯å¦ä¸ºæˆ‘ä»¬éœ€è¦çš„ Keyã€‚</p>
<h3 id="è‡ªåŠ¨æ‰©å®¹-resize-transfer"><a href="#è‡ªåŠ¨æ‰©å®¹-resize-transfer" class="headerlink" title="è‡ªåŠ¨æ‰©å®¹-resize+transfer"></a>è‡ªåŠ¨æ‰©å®¹-resize+transfer</h3><p>ä¸Šé¢æˆ‘ä»¬ä¹Ÿè¯´äº†ï¼Œæœ‰ä¸€ä¸ªé˜ˆå€¼ï¼Œå³ <code>load factor Ã— capacity</code> è¿™ä¸ªé˜ˆå€¼ï¼Œå¦‚æœå½“å‰å“ˆå¸Œè¡¨çš„å¤§å°è¶…è¿‡äº†è¿™ä¸ªé˜ˆå€¼ï¼Œé‚£ä¹ˆå“ˆå¸Œè¡¨æ˜¯éœ€è¦æ‰©å®¹çš„ï¼Œåœ¨ HashMap ä¸­ï¼Œå®ƒæ˜¯ä¸è¦æ‰‹åŠ¨å¹²é¢„ï¼Œæ˜¯ä¼šè‡ªåŠ¨è¿›è¡Œæ‰©å®¹çš„ã€‚é‚£ä¹ˆå®ƒæ˜¯æ€æ ·è‡ªåŠ¨æ‰©å®¹çš„ï¼Ÿ</p>
<p>å›é¡¾ï¼š</p>
<ul>
<li>å“ˆå¸Œè¡¨çš„å®¹é‡ï¼šæ˜¯æŒ‡ table æ•°ç»„çš„é•¿åº¦ã€‚</li>
<li>å“ˆå¸Œè¡¨çš„å¤§å°ï¼šæ˜¯æŒ‡å­˜å‚¨åœ¨å“ˆå¸Œè¡¨ä¸­çš„å…ƒç´ ï¼ˆEntry ç±»å‹çš„å…ƒç´ ï¼‰çš„ä¸ªæ•°ã€‚</li>
<li>capacityï¼ˆå®¹é‡ï¼‰ï¼šé»˜è®¤16</li>
<li>load factorï¼ˆè´Ÿè½½å› å­ï¼‰ï¼šé»˜è®¤0.75</li>
<li>thresholdï¼ˆé˜ˆå€¼ï¼‰ï¼šé»˜è®¤ 0.75 Ã— 16 &#x3D; 12ï¼Œå³å“ˆå¸Œè¡¨å¤§å°è¶…è¿‡12å°±ä¼šè‡ªåŠ¨æ‰©å®¹</li>
</ul>
<p>æˆ‘ä»¬å›å»çœ‹ä¸‹ put æ“ä½œï¼Œå¯ä»¥çœ‹åˆ°å€’æ•°ç¬¬äºŒè¡Œä»£ç æœ‰ä¸ª <code>addEntry()</code> æ–¹æ³•</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">putForNullKey</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> hash <span class="token operator">=</span> <span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Object</span> k<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">recordAccess</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    modCount<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">addEntry</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// å°±æ˜¯è¿™é‡Œï¼Œæ·»åŠ  Entry å¯¹è±¡</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>çœ‹ <code>addEntry()</code> çš„æºç ï¼Œæ˜¯è¿™æ ·çš„ï¼š</p>
<ul>
<li>å­˜å‚¨ Keyã€Valueã€hash å€¼åˆ°æŒ‡å®šçš„å“ˆå¸Œæ¡¶ä¸­ã€‚</li>
<li>åˆ¤æ–­å½“å‰å“ˆå¸Œè¡¨å¤§å°åŠ ä¸€åï¼Œæœ‰æ²¡æœ‰è¶…å‡ºé˜ˆå€¼ã€‚è¶…è¿‡é˜ˆå€¼åˆ™è¿›è¡Œå“ˆå¸Œè¡¨å®¹é‡çš„ <code>resize()</code> æ“ä½œã€‚</li>
</ul>
<p>æ‰€ä»¥è¿™ä¸ªæ‰©å®¹å°±æ˜¯é€šè¿‡ <code>addEntry()</code> æ–¹æ³•é‡Œçš„ <code>size++ &gt;= threshold</code> è¿›è¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼Œè¿›è€Œè°ƒç”¨æ‰©å®¹æ–¹æ³• <code>resize()</code> å®ç°æ‰€è°“çš„è‡ªåŠ¨æ‰©å®¹ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Adds a new entry with the specified key, value and hash code to
 * the specified bucket.  It is the responsibility of this
 * method to resize the table if appropriate.
 *
 * Subclass overrides this to alter the behavior of put method.
 */</span>
<span class="token keyword">void</span> <span class="token function">addEntry</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">int</span> bucketIndex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> table<span class="token punctuation">[</span>bucketIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
    table<span class="token punctuation">[</span>bucketIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>size<span class="token operator">++</span> <span class="token operator">>=</span> threshold<span class="token punctuation">)</span>
        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>resize()</code> çš„æ—¶å€™ï¼Œå‚æ•°æ˜¯<strong>ä¸¤å€çš„æ•°ç»„é•¿åº¦</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´å°†å“ˆå¸Œè¡¨çš„å®¹é‡æ‰©å¤§æˆåŸæ¥çš„ä¸¤å€ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token function">resize</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> table<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

<p>é‚£ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹æ‰©å®¹æ˜¯æ€æ ·å­çš„ï¼Œçœ‹çœ‹ <code>resize()</code> æºç ï¼š</p>
<p>æºç æ³¨é‡Šä¹Ÿè¯´äº†ï¼Œå°†ä¼šå¯¹ HashMap å®ä¾‹å­˜å‚¨çš„ Entry è¿›è¡Œ rehashï¼ˆå†æ¬¡å“ˆå¸Œï¼‰åˆ°ä¸€ä¸ªæ‰©å®¹åçš„æ–°æ•°ç»„ã€‚å¦‚æœå½“å‰å®¹é‡æ˜¯æœ€å¤§å®¹é‡ï¼ˆMAXIMUM_CAPACITYï¼Œ1 &lt;&lt;&lt; 30ï¼Œå³$2^{30}$ï¼‰äº†ï¼Œé‚£ä¹ˆå°±ä¸ä¼šè¿›è¡Œæ‰©å®¹ï¼ŒåŒæ—¶è®¾ç½®é˜ˆå€¼ä¸º <code>Integer.MAX_VALUE</code>ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Rehashes the contents of this map into a new array with a
 * larger capacity.  This method is called automatically when the
 * number of keys in this map reaches its threshold.
 *
 * If current capacity is MAXIMUM_CAPACITY, this method does not
 * resize the map, but sets threshold to Integer.MAX_VALUE.
 * This has the effect of preventing future calls.
 *
 * @param newCapacity the new capacity, MUST be a power of two;
 *        must be greater than current capacity unless current
 *        capacity is MAXIMUM_CAPACITY (in which case value
 *        is irrelevant).
 */</span>
<span class="token keyword">void</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token keyword">int</span> newCapacity<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTable <span class="token operator">=</span> table<span class="token punctuation">;</span>			<span class="token comment">// åŸæ•°ç»„</span>
    <span class="token keyword">int</span> oldCapacity <span class="token operator">=</span> oldTable<span class="token punctuation">.</span>length<span class="token punctuation">;</span>	<span class="token comment">// åŸæ•°ç»„é•¿åº¦ = åŸå®¹é‡</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCapacity <span class="token operator">==</span> MAXIMUM_CAPACITY<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        threshold <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token comment">// åˆ›å»ºä¸€ä¸ªæ¯”åŸæ•°ç»„é•¿åº¦å¤§ä¸¤å€çš„æ–°æ•°ç»„</span>
    <span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">[</span>newCapacity<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// è½¬ç§»åŸæ•°ç»„ä¸­çš„å…ƒç´ ï¼ˆEntry å¯¹è±¡ï¼‰åˆ°æ–°æ•°ç»„ä¸­</span>
    <span class="token function">transfer</span><span class="token punctuation">(</span>newTable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åŸæ•°ç»„å¼•ç”¨æŒ‡å‘æ–°æ•°ç»„</span>
    table <span class="token operator">=</span> newTable<span class="token punctuation">;</span>
    <span class="token comment">// é‡æ–°è®¡ç®—é˜ˆå€¼</span>
    threshold <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>newCapacity <span class="token operator">*</span> loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * Transfers all entries from current table to newTable.
 */</span>
<span class="token keyword">void</span> <span class="token function">transfer</span><span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Entry</span><span class="token punctuation">[</span><span class="token punctuation">]</span> src <span class="token operator">=</span> table<span class="token punctuation">;</span>	<span class="token comment">// åŸæ•°ç»„</span>
    <span class="token keyword">int</span> newCapacity <span class="token operator">=</span> newTable<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token comment">// éå†åŸæ•°ç»„</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> src<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// e å¯ä»¥çœ‹æˆä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ç¬¬jä¸ªå“ˆå¸Œæ¡¶ä¸Šçš„EntryèŠ‚ç‚¹</span>
        <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> src<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            src<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// çœ‹å½“å‰ä½ç½®ä¸Šçš„ Entry æœ‰æ²¡æœ‰ nextï¼Œæœ‰åˆ™è¯´æ˜æ˜¯é“¾è¡¨</span>
                <span class="token comment">// next æ˜¯ nullï¼Œè¯´æ˜æ²¡æœ‰é“¾è¡¨ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ‰§è¡Œä¸‹é¢çš„ while</span>
                <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
                <span class="token comment">// è®¡ç®—å½“å‰ Entry åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®</span>
                <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">indexFor</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash<span class="token punctuation">,</span> newCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// e çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘æ–°çš„å“ˆå¸Œæ¡¶ï¼Œå¯ä»¥æŠŠå“ˆå¸Œæ¡¶å½“ä½œè¡¨å¤´ï¼Œè¿™æ ·æ–¹ä¾¿å¤´æ’æ³•æ’å…¥å…ƒç´ </span>
                e<span class="token punctuation">.</span>next <span class="token operator">=</span> newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token comment">// æ–°çš„å“ˆå¸Œæ¡¶å­˜å‚¨è¿™ä¸ªèŠ‚ç‚¹</span>
                newTable<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
                <span class="token comment">// ç§»åŠ¨æŒ‡é’ˆ e æŒ‡å‘ä¸‹ä¸€èŠ‚ç‚¹</span>
                e <span class="token operator">=</span> next<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>æ‰€ä»¥ï¼Œæ€»çš„æ¥è¯´ï¼Œ<strong>æ‰©å®¹çš„è¿‡ç¨‹æ˜¯è¿™æ ·çš„</strong>ï¼š</p>
<p>æˆ‘ä»¬ put ä¸€ä¸ªå…ƒç´ åˆ°å“ˆå¸Œè¡¨ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šè°ƒç”¨ <code>addEntry()</code> æ–¹æ³•ï¼Œåœ¨å®é™…æ’å…¥ä¸€ä¸ªå…ƒç´ åï¼Œåˆ¤æ–­å½“å‰ size æ˜¯å¦å¤§äºé˜ˆå€¼ï¼Œå¤§äºçš„è¯å°±ä¼šæ‰©å®¹ï¼Œæ‰©å®¹çš„è¯ï¼Œä¼šä¼ å…¥ä¸€ä¸ªä¸¤å€åŸæ•°ç»„å¤§å°çš„å‚æ•°ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„çš„é•¿åº¦æ˜¯åŸæ•°ç»„çš„ä¸¤å€ï¼Œå†é€šè¿‡ä¸€ä¸ª <code>transfer()</code> æ–¹æ³•ï¼Œå°†åŸæ•°ç»„ä¸­çš„ Entry é‡æ–°å“ˆå¸Œï¼ˆrehashï¼‰åˆ°æ–°æ•°ç»„ä¸­ï¼Œæœ€åå°†åŸæ•°ç»„å¼•ç”¨æŒ‡å‘æ–°æ•°ç»„ï¼ŒåŒæ—¶è®¡ç®—ä¸‹æ–°çš„é˜ˆå€¼ã€‚</p>
<h3 id="1-7-æ€»ç»“"><a href="#1-7-æ€»ç»“" class="headerlink" title="1.7 æ€»ç»“"></a>1.7 æ€»ç»“</h3><p>1.7 çš„ HashMapï¼Œ<strong>åº•å±‚æ˜¯ Entry ç±»å‹çš„æ•°ç»„ + Entry ç±»å‹çš„é“¾è¡¨</strong>ã€‚</p>
<p>è¿™ä¸ªæ•°ç»„ç§°ä¸º <strong>table æ•°ç»„</strong>ï¼ˆä¹Ÿæœ‰çš„äººç§°ä¸ºæ¡¶æ•°ç»„ï¼‰ï¼Œæ•°ç»„ä¸Šçš„æ¯ä¸ªä½ç½®ï¼Œå¯ä»¥ç§°ä¸º<strong>å“ˆå¸Œæ¡¶</strong>ï¼Œæ¯ä¸€ä¸ªå“ˆå¸Œæ¡¶éƒ½æ˜¯å­˜å‚¨ Entry ç±»å‹çš„å…ƒç´ çš„ï¼ŒåŒæ—¶å¯ä»¥çŸ¥é“<strong>æ¯ä¸ªå“ˆå¸Œæ¡¶ä½ç½®ä¸Šéƒ½å¯ä»¥å¯¹åº”ç€ä¸€ä¸ªè§£å†³å†²çªçš„é“¾è¡¨çš„ä½ç½®</strong>ã€‚</p>
<p>å¦‚æœå½“è¦å­˜å‚¨çš„ Key-Value çš„ Key ä¸å½“å‰ä½ç½®ä¸Šçš„ Key å‘ç”Ÿå†²çªï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œ<strong>å¤´æ’æ³•</strong>ï¼Œå°†è¯¥ Key æ’å…¥å½“å‰å“ˆå¸Œæ¡¶å¯¹åº”çš„é“¾è¡¨ã€‚</p>
<p>å¦‚æœå½“å‰å­˜å‚¨çš„å…ƒç´ çš„ä¸ªæ•°è¶…è¿‡äº†<strong>é˜ˆå€¼</strong>ï¼ˆthreshold &#x3D; load factor Ã— capacityï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šè¿›è¡Œ<strong>æ‰©å®¹</strong>ï¼Œåˆ›å»ºä¸€ä¸ª<strong>ä¸¤å€åŸæ•°ç»„å¤§å°çš„æ–°æ•°ç»„</strong>ï¼Œç„¶åå°†åŸæ•°ç»„ä¸­çš„å…ƒç´ <strong>é‡æ–°å“ˆå¸Œ</strong>åˆ°æ–°æ•°ç»„ä¸­ï¼Œæœ€ååŸæ•°ç»„å¼•ç”¨æŒ‡å‘æ–°æ•°ç»„ï¼Œè¿›è€Œå®Œæˆæ‰©å®¹ã€‚</p>
<h2 id="1-8-ç‰ˆ-HashMap"><a href="#1-8-ç‰ˆ-HashMap" class="headerlink" title="1.8 ç‰ˆ HashMap"></a>1.8 ç‰ˆ HashMap</h2><p><img src="https://pic-bed-of-god23bin.oss-cn-shenzhen.aliyuncs.com/img/20221030195148.png" alt="1.8 çš„HashMap" loading="lazy"></p>
<p>åœ¨ JDK 1.8 å¼€å§‹ï¼Œå°±å˜æˆäº†ã€Œæ•°ç»„+é“¾è¡¨&#x2F;çº¢é»‘æ ‘ã€</p>
<p>çœ‹çœ‹æºç ä¸1.7æœ‰ä»€ä¹ˆåŒºåˆ«</p>
<h3 id="çœ‹çœ‹åŒºåˆ«"><a href="#çœ‹çœ‹åŒºåˆ«" class="headerlink" title="çœ‹çœ‹åŒºåˆ«"></a>çœ‹çœ‹åŒºåˆ«</h3><ul>
<li>DEFAULT_INITIAL_CAPACITY å†™æ³•å˜é«˜çº§äº†ï¼Œä» <code>16</code> ç›´æ¥æ”¹æˆ <code>1 &lt;&lt; 4</code></li>
</ul>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEFAULT_INITIAL_CAPACITY <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// aka 16</span></code></pre>

<ul>
<li>å‡ºç°ä¸€ä¸ª<code>TREEIFY_THRESHOLD</code>ï¼Œæ ‘åŒ–é˜ˆå€¼ï¼Œå³é“¾è¡¨è½¬æˆçº¢é»‘æ ‘çš„é˜ˆå€¼ï¼Œé»˜è®¤ä¸º 8ã€‚</li>
</ul>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> TREEIFY_THRESHOLD <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span></code></pre>

<ul>
<li>å‡ºç°ä¸€ä¸ª<code>UNTREEIFY_THRESHOLD</code>ï¼Œè§£é™¤æ ‘åŒ–çš„é˜ˆå€¼ï¼Œå³çº¢é»‘æ ‘ä¸­çš„ Entry æ•°é‡å°äº 6ï¼Œé‚£ä¹ˆå°±ä»çº¢é»‘æ ‘é€€åŒ–æˆé“¾è¡¨ã€‚</li>
</ul>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> UNTREEIFY_THRESHOLD <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span></code></pre>

<ul>
<li>å‡ºç°ä¸€ä¸ª<code>MIN_TREEIFY_CAPACITY</code>ï¼Œæœ€å°æ ‘åŒ–å®¹é‡ï¼Œå³ table æ•°ç»„çš„é•¿åº¦æœ€å°éœ€è¦ 64ï¼Œæ‰æœ‰æœºä¼šæ ‘åŒ–ã€‚</li>
</ul>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> MIN_TREEIFY_CAPACITY <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">;</span></code></pre>

<h3 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h3><p>æ¥ç€ï¼Œæˆ‘ä»¬çœ‹åˆ°è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ª Node èŠ‚ç‚¹ï¼Œé€šè¿‡å¯¹æ¯” 1.7 ç‰ˆçš„ï¼Œå¯ä»¥å‘ç°è¿™ä¸ªæŠŠ 1.7 ä¸­çš„ Entry æ¢äº†ä¸ªåï¼Œå®šä¹‰æˆ Node èŠ‚ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ 1.8 ä¸­çš„ table æ•°ç»„ï¼Œå…¶ç±»å‹ä¸å†æ˜¯ Entry ç±»å‹ï¼Œè€Œæ˜¯ Node ç±»å‹ï¼Œå³ Node ç±»å‹çš„ table æ•°ç»„ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * Basic hash bin node, used for most entries.  (See below for
 * TreeNode subclass, and in LinkedHashMap for its Entry subclass.)
 */</span>
<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token keyword">implements</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">final</span> <span class="token keyword">int</span> hash<span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">K</span> key<span class="token punctuation">;</span>
    <span class="token class-name">V</span> value<span class="token punctuation">;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">;</span>

    <span class="token class-name">Node</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>hash <span class="token operator">=</span> hash<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">K</span> <span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> key<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> value<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">return</span> key <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> value<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">setValue</span><span class="token punctuation">(</span><span class="token class-name">V</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">V</span> oldValue <span class="token operator">=</span> value<span class="token punctuation">;</span>
        value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
        <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token keyword">instanceof</span> <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">></span></span> e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>o<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>Node æ•°ç»„</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">transient</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> table<span class="token punctuation">;</span></code></pre>

<h3 id="æ‰°åŠ¨å‡½æ•°"><a href="#æ‰°åŠ¨å‡½æ•°" class="headerlink" title="æ‰°åŠ¨å‡½æ•°"></a>æ‰°åŠ¨å‡½æ•°</h3><p>hash()ï¼Œæ‰°åŠ¨å‡½æ•°å‘ç”Ÿäº†å˜åŒ–ï¼Œ1.8 æºç æ˜¯è¿™æ ·çš„ï¼š</p>
<p>è®© Key çš„ hashCode ä¸ä¸Š hashCode æ— ç¬¦å·å³ç§» 16 ä½ï¼Œæœ€ç»ˆä¸è¿ç®—çš„ç»“æœå°±æ˜¯æœ€ç»ˆçš„ hash å€¼ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">int</span> h<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>è€Œ 1.7 çš„æ˜¯è¿™æ ·çš„ï¼š</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">hash</span><span class="token punctuation">(</span><span class="token keyword">int</span> h<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    h <span class="token operator">^=</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> h <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>h <span class="token operator">>>></span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="æ„é€ æ–¹æ³•"><a href="#æ„é€ æ–¹æ³•" class="headerlink" title="æ„é€ æ–¹æ³•"></a>æ„é€ æ–¹æ³•</h3><p>æ„é€ æ–¹æ³•ä¹Ÿæœ‰å˜åŒ–ï¼Œä½†æ˜¯ä¸»è¦çš„è¿‡ç¨‹è¿˜æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦çš„åŒºåˆ«å°±æ˜¯ï¼Œæ­¤æ—¶çš„ table æ•°ç»„è¿˜æ²¡æœ‰è¢«åˆ›å»ºå‡ºæ¥ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java">   <span class="token comment">/**
    * Returns a power of two size for the given target capacity.
    */</span>
   <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">tableSizeFor</span><span class="token punctuation">(</span><span class="token keyword">int</span> cap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">int</span> n <span class="token operator">=</span> cap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
       n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">1</span><span class="token punctuation">;</span>
       n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">2</span><span class="token punctuation">;</span>
       n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">4</span><span class="token punctuation">;</span>
       n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">8</span><span class="token punctuation">;</span>
       n <span class="token operator">|=</span> n <span class="token operator">>>></span> <span class="token number">16</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token punctuation">(</span>n <span class="token operator">>=</span> MAXIMUM_CAPACITY<span class="token punctuation">)</span> <span class="token operator">?</span> MAXIMUM_CAPACITY <span class="token operator">:</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> initialCapacity<span class="token punctuation">,</span> <span class="token keyword">float</span> loadFactor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal initial capacity: "</span> <span class="token operator">+</span>
                                              initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>initialCapacity <span class="token operator">></span> MAXIMUM_CAPACITY<span class="token punctuation">)</span>
           initialCapacity <span class="token operator">=</span> MAXIMUM_CAPACITY<span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>loadFactor <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token class-name">Float</span><span class="token punctuation">.</span><span class="token function">isNaN</span><span class="token punctuation">(</span>loadFactor<span class="token punctuation">)</span><span class="token punctuation">)</span>
           <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Illegal load factor: "</span> <span class="token operator">+</span>
                                              loadFactor<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> loadFactor<span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>threshold <span class="token operator">=</span> <span class="token function">tableSizeFor</span><span class="token punctuation">(</span>initialCapacity<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>

   <span class="token keyword">public</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>loadFactor <span class="token operator">=</span> DEFAULT_LOAD_FACTOR<span class="token punctuation">;</span> <span class="token comment">// all other fields defaulted</span>
   <span class="token punctuation">&#125;</span></code></pre>

<p>å¯ä»¥è¯´åœ¨ 1.8 è¿™é‡Œï¼ŒHashMap å±äº<strong>æ‡’åŠ è½½</strong>çš„äº†ï¼Œé‚£ä¹ˆ table æ•°ç»„ä½•æ—¶åŠ è½½ï¼ˆåˆ›å»ºï¼‰å‘¢ï¼Ÿæ²¡é”™ï¼Œå°±æ˜¯åœ¨ put çš„æ—¶å€™æ‰åˆ›å»ºçš„ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ã€‚</p>
<h3 id="put-çš„å˜åŒ–"><a href="#put-çš„å˜åŒ–" class="headerlink" title="put çš„å˜åŒ–"></a>put çš„å˜åŒ–</h3><p>put å¤šäº†ä¸€å±‚å°è£…ï¼Œéœ€è¦åœ¨ <code>putVal()</code> æ–¹æ³•ä¸­ç†è§£</p>
<ul>
<li><code>final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict)</code></li>
<li><code>hash</code>ï¼šKey é€šè¿‡æ‰°åŠ¨å‡½æ•°å¾—åˆ°æœ€ç»ˆ hash å€¼ã€‚</li>
<li><code>key</code>ã€<code>value</code>ï¼šé”® å’Œ å€¼ã€‚</li>
<li><code>onlyIfAbsent</code>ï¼šå¦‚æœä¸º trueï¼Œé‚£ä¹ˆä¸ä¼šæ”¹å˜å·²å­˜åœ¨çš„å€¼ã€‚</li>
<li><code>evict</code>ï¼šå¦‚æœä¸º falseï¼Œè¯´æ˜ table æ•°ç»„æ­£åœ¨åˆ›å»ºä¸­ã€‚</li>
</ul>
<p>put çš„æ€è·¯è¿˜æ˜¯ä¸€æ ·çš„ï¼šæ ¹æ® Key è®¡ç®—å‡ºå“ˆå¸Œåœ°å€ï¼Œåˆ¤æ–­è¿™ä¸ªåœ°å€ä¸Šæœ‰æ²¡æœ‰å†²çªï¼Œæ²¡æœ‰åˆ™ç›´æ¥æ’å…¥è¿™ä¸ª Nodeï¼Œæœ‰åˆ™éœ€è¦è§£å†³å†²çªã€‚å˜åŒ–å¤§çš„å°±æ˜¯ä»£ç çš„å®ç°ï¼ˆçº¢é»‘æ ‘ã€å°¾æ’æ³•ï¼‰ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * Implements Map.put and related methods.
 *
 * @param hash hash for key
 * @param key the key
 * @param value the value to put
 * @param onlyIfAbsent if true, don't change existing value
 * @param evict if false, the table is in creation mode.
 * @return previous value, or null if none
 */</span>
<span class="token keyword">final</span> <span class="token class-name">V</span> <span class="token function">putVal</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">K</span> key<span class="token punctuation">,</span> <span class="token class-name">V</span> value<span class="token punctuation">,</span> <span class="token keyword">boolean</span> onlyIfAbsent<span class="token punctuation">,</span>
               <span class="token keyword">boolean</span> evict<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// tab-> table æ•°ç»„</span>
    <span class="token comment">// p-> node æŒ‡é’ˆï¼ŒæŒ‡å‘å“ˆå¸Œæ¡¶ä¸­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥è¯´æ˜¯é“¾è¡¨è¡¨å¤´èŠ‚ç‚¹</span>
    <span class="token comment">// n-> ä»£è¡¨ table æ•°ç»„çš„é•¿åº¦</span>
    <span class="token comment">// i-> ä»£è¡¨ table æ•°ç»„çš„ä¸‹æ ‡</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> p<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> i<span class="token punctuation">;</span>
    <span class="token comment">// ç¬¬ä¸€æ¬¡ put å°±ä¼šè¿›å…¥è¿™ä¸ªåˆ¤æ–­ï¼Œè¿›è¡Œæ•°ç»„çš„åˆ›å»º</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        n <span class="token operator">=</span> <span class="token punctuation">(</span>tab <span class="token operator">=</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token comment">// å¦‚æœ put çš„è¿™ä¸ª Keyï¼Œæ‰¾åˆ°çš„ä½ç½®ä¸ä¼šå†²çªï¼Œé‚£ä¹ˆç›´æ¥åˆ›å»ºä¸€ä¸ª Node èŠ‚ç‚¹å­˜å‚¨è¿™ä¸ªé”®å€¼å¯¹</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>p <span class="token operator">=</span> tab<span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        tab<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// å‘ç”Ÿå†²çªè¿›å…¥è¿™é‡Œ</span>
        <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span> <span class="token class-name">K</span> k<span class="token punctuation">;</span>
        <span class="token comment">// åˆ¤æ–­æ˜¯å¦æ˜¯åŒä¸€ä¸ªKeyï¼Œæ˜¯å°±æŠŠæŒ‡é’ˆ e æŒ‡å‘è¿™ä¸ªèŠ‚ç‚¹ pï¼Œç„¶åç›´æ¥èµ°ä¸‹é¢çš„ e æ˜¯å¦ä¸ºç©ºçš„åˆ¤æ–­äº†</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> p<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            e <span class="token operator">=</span> p<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>	<span class="token comment">// Key ä¸åŒï¼Œèµ°è¿™é‡Œï¼Œå¦‚æœè¿™ä¸ªèŠ‚ç‚¹ p æ˜¯ä¸€ä¸ªæ ‘èŠ‚ç‚¹</span>
            e <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>p<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putTreeVal</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> tab<span class="token punctuation">,</span> hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>	<span class="token comment">// Key ä¸åŒï¼Œæ²¡æœ‰æ ‘åŒ–ï¼Œéœ€è¦éå†é“¾è¡¨</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> binCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> <span class="token operator">++</span>binCount<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// e æŒ‡å‘çš„ p çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœä¸ºç©ºï¼Œè¯´æ˜æ˜¯é“¾è¡¨å°¾éƒ¨äº†</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> p<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    p<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token function">newNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>binCount <span class="token operator">>=</span> TREEIFY_THRESHOLD <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// -1 for 1st</span>
                        <span class="token function">treeifyBin</span><span class="token punctuation">(</span>tab<span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
                <span class="token comment">// èµ°åˆ°è¿™é‡Œï¼Œä¸æ˜¯é“¾è¡¨å°¾éƒ¨ï¼Œç»§ç»­åˆ¤æ–­ Key ç›¸åŒä¸å¦ï¼Œç›¸åŒå°±è·³å‡ºå¾ªç¯ï¼Œèµ°ä¸‹é¢çš„åˆ¤æ–­</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token comment">// ç§»åŠ¨æŒ‡é’ˆ</span>
                p <span class="token operator">=</span> e<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">// è¿™é‡Œå°±æ˜¯ï¼Œå¦‚æœæ˜¯åŒä¸€ä¸ª Key ï¼Œå°±ä¼šèµ°è¿™é‡Œçš„è¦†ç›–</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// existing mapping for key</span>
            <span class="token class-name">V</span> oldValue <span class="token operator">=</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>onlyIfAbsent <span class="token operator">||</span> oldValue <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                e<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token function">afterNodeAccess</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token operator">++</span>modCount<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>size <span class="token operator">></span> threshold<span class="token punctuation">)</span>	<span class="token comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹</span>
        <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">afterNodeInsertion</span><span class="token punctuation">(</span>evict<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<h3 id="get-çš„å˜åŒ–"><a href="#get-çš„å˜åŒ–" class="headerlink" title="get çš„å˜åŒ–"></a>get çš„å˜åŒ–</h3><p>get ä¹Ÿæ˜¯ï¼Œå¤šäº†ä¸€å±‚å°è£…ï¼Œæ€è·¯è¿˜æ˜¯ä¸€æ ·ï¼Œè·å–å“ˆå¸Œåœ°å€ï¼Œåˆ¤æ–­è¯¥ä½ç½®ä¸Šçš„å…ƒç´ æ˜¯å¦æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">V</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>e <span class="token operator">=</span> <span class="token function">getNode</span><span class="token punctuation">(</span><span class="token function">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> e<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> <span class="token function">getNode</span><span class="token punctuation">(</span><span class="token keyword">int</span> hash<span class="token punctuation">,</span> <span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> tab<span class="token punctuation">;</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> first<span class="token punctuation">,</span> e<span class="token punctuation">;</span> <span class="token keyword">int</span> n<span class="token punctuation">;</span> <span class="token class-name">K</span> k<span class="token punctuation">;</span>
    <span class="token comment">// åˆ¤æ–­å½“å‰å“ˆå¸Œè¡¨æ˜¯å¦å­˜åœ¨ã€æ˜¯å¦æœ‰å…ƒç´ ã€å¾—åˆ°çš„å“ˆå¸Œåœ°å€ä¸Šæ˜¯å¦æœ‰å…ƒç´ ï¼ˆç®—æ³•çš„å¥å£®æ€§ï¼‰</span>
    <span class="token comment">// åˆ¤æ–­ä¸º false çš„è¯ï¼Œè‡ªç„¶è¯´æ˜æ²¡æœ‰ä»»ä½•å…ƒç´ ï¼Œè¿˜ get ä¸ª pï¼Ÿ</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tab <span class="token operator">=</span> table<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> tab<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
        <span class="token punctuation">(</span>first <span class="token operator">=</span> tab<span class="token punctuation">[</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> hash<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// å“ˆå¸Œæ¡¶ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Ÿæ˜¯å°±ç›´æ¥è¿”å›äº†</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>first<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span> <span class="token comment">// always check first node</span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> first<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> first<span class="token punctuation">;</span>
        <span class="token comment">// ä¸æ˜¯ï¼Œé‚£ä¹ˆçœ‹å“ˆå¸Œæ¡¶ä¸Šçš„é“¾è¡¨/çº¢é»‘æ ‘</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> first<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>first <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>first<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTreeNode</span><span class="token punctuation">(</span>hash<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">==</span> hash <span class="token operator">&amp;&amp;</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span>k <span class="token operator">=</span> e<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">==</span> key <span class="token operator">||</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span> e<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>



<h3 id="æ‰©å®¹æœºåˆ¶"><a href="#æ‰©å®¹æœºåˆ¶" class="headerlink" title="æ‰©å®¹æœºåˆ¶"></a>æ‰©å®¹æœºåˆ¶</h3><p>1.8 çš„æ‰©å®¹æœºåˆ¶ï¼Œå˜åŒ–å°±å¤§äº†ï¼åœ¨ 1.7 çš„æ—¶å€™ï¼Œä¸»è¦æ˜¯é€šè¿‡ <code>resize()</code> å’Œ <code>transfer()</code> ç›¸äº’é…åˆå®Œæˆæ‰©å®¹åŠå…ƒç´ è½¬ç§»çš„ï¼Œåœ¨ 1.8 çš„æ—¶å€™ï¼Œç›´æ¥æŠŠ <code>transfer()</code> ä¹Ÿæåˆ° <code>resize()</code> ä¸­äº†ï¼Œè€Œä¸” transfer çš„ rehash çš„ç®—æ³•å¾ˆç¾å¦™ã€‚ä¸è¿‡æ‰©å®¹æ—¶æœºè¿˜æ˜¯ä¸€æ ·ï¼Œè¶…è¿‡é˜ˆå€¼å°±ä¼šæ‰©å®¹ã€‚</p>
<p>æˆ‘ä»¬çœ‹çœ‹æºç æ˜¯è¿™æ ·çš„ï¼š</p>
<pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">final</span> <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> oldTab <span class="token operator">=</span> table<span class="token punctuation">;</span>	<span class="token comment">// ä¸€å¼€å§‹ table è¿˜æ²¡åˆ›å»ºï¼Œæ‰€ä»¥ç¬¬ä¸€æ¬¡è¿™é‡Œçš„ oldTab ä¸ºç©º</span>
    <span class="token keyword">int</span> oldCap <span class="token operator">=</span> <span class="token punctuation">(</span>oldTab <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> oldTab<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">int</span> oldThr <span class="token operator">=</span> threshold<span class="token punctuation">;</span>
    <span class="token keyword">int</span> newCap<span class="token punctuation">,</span> newThr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCap <span class="token operator">>=</span> MAXIMUM_CAPACITY<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            threshold <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">;</span>
            <span class="token keyword">return</span> oldTab<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>newCap <span class="token operator">=</span> oldCap <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> MAXIMUM_CAPACITY <span class="token operator">&amp;&amp;</span>
                 oldCap <span class="token operator">>=</span> DEFAULT_INITIAL_CAPACITY<span class="token punctuation">)</span>
            newThr <span class="token operator">=</span> oldThr <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// double threshold é˜ˆå€¼æ›´æ–°ä¸ºåŸæ¥çš„ä¸¤å€</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldThr <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// initial capacity was placed in threshold</span>
        newCap <span class="token operator">=</span> oldThr<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>               <span class="token comment">// zero initial threshold signifies using defaults</span>
        <span class="token comment">// é»˜è®¤åˆå§‹åŒ–</span>
        newCap <span class="token operator">=</span> DEFAULT_INITIAL_CAPACITY<span class="token punctuation">;</span>
        newThr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>DEFAULT_LOAD_FACTOR <span class="token operator">*</span> DEFAULT_INITIAL_CAPACITY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newThr <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">float</span> ft <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>newCap <span class="token operator">*</span> loadFactor<span class="token punctuation">;</span>
        newThr <span class="token operator">=</span> <span class="token punctuation">(</span>newCap <span class="token operator">&lt;</span> MAXIMUM_CAPACITY <span class="token operator">&amp;&amp;</span> ft <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>MAXIMUM_CAPACITY <span class="token operator">?</span>
                  <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>ft <span class="token operator">:</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    threshold <span class="token operator">=</span> newThr<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token string">"rawtypes"</span><span class="token punctuation">,</span><span class="token string">"unchecked"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token comment">// æ‰©å®¹ï¼Œåˆ›å»ºæ–°çš„ Node æ•°ç»„ï¼ˆå½“ç„¶ï¼Œç¬¬ä¸€æ¬¡åˆ›å»ºæ•°ç»„ä¹Ÿæ˜¯åœ¨è¿™é‡Œåˆ›å»ºï¼‰</span>
    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> newTab <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">[</span>newCap<span class="token punctuation">]</span><span class="token punctuation">;</span>
    table <span class="token operator">=</span> newTab<span class="token punctuation">;</span>
    <span class="token comment">// åŸæ•°ç»„ä¸ä¸ºç©º</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldTab <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// éå†åŸæ•°ç»„</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> oldCap<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> e<span class="token punctuation">;</span>	<span class="token comment">// å¯ä»¥çœ‹æˆä¸€ä¸ªæŒ‡é’ˆ</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>	<span class="token comment">// åˆ¤æ–­ç¬¬jä¸ªå“ˆå¸Œæ¡¶æ˜¯å¦ä¸ºç©º</span>
                oldTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>next <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>		<span class="token comment">// å¦‚æœè¿™ä¸ªå“ˆå¸Œæ¡¶æ²¡æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¯´æ˜æ²¡æœ‰é“¾è¡¨</span>
                    newTab<span class="token punctuation">[</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> <span class="token punctuation">(</span>newCap <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">TreeNode</span><span class="token punctuation">)</span>	<span class="token comment">// å¦‚æœè¿™ä¸ªèŠ‚ç‚¹æ˜¯æ ‘èŠ‚ç‚¹</span>
                    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">TreeNode</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> newTab<span class="token punctuation">,</span> j<span class="token punctuation">,</span> oldCap<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">// preserve order</span>
                    <span class="token comment">// ä¸æ˜¯æ ‘èŠ‚ç‚¹å¹¶ä¸”æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¯´æ˜æœ‰é“¾è¡¨</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> loHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> loTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> hiHead <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> hiTail <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token class-name">Node</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">,</span><span class="token class-name">V</span><span class="token punctuation">></span></span> next<span class="token punctuation">;</span>
                    <span class="token comment">// å°¾æ’æ³•è½¬ç§»é“¾è¡¨æ•°æ®ï¼Œç›´åˆ°é“¾è¡¨æ²¡æœ‰å…ƒç´ ä¸ºæ­¢</span>
                    <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>
                        next <span class="token operator">=</span> e<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
                        <span class="token comment">// å¦‚æœè¿™ä¸ªä¸æ“ä½œç»“æœä¸º0ï¼Œé‚£ä¹ˆæ”¾å…¥æ–°æ•°ç»„çš„ä½ç½®å’ŒåŸæ•°ç»„çš„ä½ç½®æ˜¯ä¸€æ ·çš„</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>hash <span class="token operator">&amp;</span> oldCap<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>	<span class="token comment">// ç›´æ¥æ”¾å…¥</span>
                                loHead <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            <span class="token keyword">else</span>				<span class="token comment">// å°¾æ’æ³•</span>
                                loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            loTail <span class="token operator">=</span> e<span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                        <span class="token comment">// ä¸æ“ä½œç»“æœä¸ä¸º0ï¼Œéœ€è¦é‡æ–°è®¡ç®—å­˜æ”¾çš„ä½ç½®</span>
                        <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>	<span class="token comment">// ç›´æ¥æ”¾å…¥</span>
                                hiHead <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            <span class="token keyword">else</span>				<span class="token comment">// å°¾æ’æ³•</span>
                                hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> e<span class="token punctuation">;</span>
                            hiTail <span class="token operator">=</span> e<span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e <span class="token operator">=</span> next<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>loTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        loTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        newTab<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> loHead<span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>hiTail <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
                        <span class="token comment">// æ–°ä½ç½®ï¼šæ‰€åœ¨çš„åŸæ•°ç»„ä½ç½®ä¸‹æ ‡åŠ ä¸ŠåŸæ•°ç»„å®¹é‡ï¼ˆé•¿åº¦ï¼‰</span>
                        hiTail<span class="token punctuation">.</span>next <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                        newTab<span class="token punctuation">[</span>j <span class="token operator">+</span> oldCap<span class="token punctuation">]</span> <span class="token operator">=</span> hiHead<span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token comment">// ç¬¬ä¸€æ¬¡ä¸ä¼šèµ°ä¸Šé¢çš„ ifï¼Œç›´æ¥è¿”å›æ–°åˆ›å»ºé»˜è®¤å®¹é‡å’Œé˜ˆå€¼çš„æ•°ç»„</span>
    <span class="token keyword">return</span> newTab<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>è¿™é‡Œé¢<strong>æœ€éš¾ç†è§£</strong>çš„å°±æ˜¯ <code>(e.hash &amp; oldCap) == 0</code> </p>
<ul>
<li>è¿ç®—ç»“æœä¸º 0 çš„è¯ï¼Œé‚£ä¹ˆæ”¾å…¥æ–°æ•°ç»„çš„ä½ç½®å’ŒåŸæ•°ç»„çš„ä½ç½®æ˜¯ä¸€æ ·çš„</li>
<li>è¿ç®—ç»“æœä¸ä¸º 0 çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡æ–°è®¡ç®—ä½ç½®ï¼ˆæ–°ä½ç½®ï¼šæ‰€åœ¨çš„åŸæ•°ç»„ä½ç½®ä¸‹æ ‡åŠ ä¸ŠåŸæ•°ç»„å®¹é‡ï¼ˆé•¿åº¦ï¼‰ï¼‰</li>
</ul>
<h3 id="ç†è§£-e-hash-amp-oldCap-x3D-x3D-0"><a href="#ç†è§£-e-hash-amp-oldCap-x3D-x3D-0" class="headerlink" title="ç†è§£ (e.hash &amp; oldCap) &#x3D;&#x3D; 0"></a>ç†è§£ (e.hash &amp; oldCap) &#x3D;&#x3D; 0</h3><p><strong>éœ€è¦çŸ¥é“çš„æ˜¯ï¼š</strong></p>
<ul>
<li>e.hashï¼š e å¯ä»¥çœ‹æˆä¸€ä¸ªæŒ‡é’ˆï¼Œæ˜¯ä¸€ä¸ªæŒ‡å‘å½“å‰éå†åˆ°çš„ Node èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œhash æŒ‡çš„æ˜¯è¯¥ Node èŠ‚ç‚¹å­˜å‚¨çš„ Key çš„ hash å€¼ï¼Œå³ hash å€¼æ˜¯é€šè¿‡ <code>hash(key.hashCode())</code> å¾—åˆ°çš„æœ€ç»ˆå­˜å‚¨çš„ hash å€¼ã€‚</li>
<li>oldCapï¼šè¡¨ç¤ºåŸæ•°ç»„çš„å®¹é‡ï¼Œå³åŸæ•°ç»„é•¿åº¦ï¼ŒåŒæ—¶è¿™ä¸ªé•¿åº¦æ˜¯ 2 æ¬¡æ–¹å¹‚ï¼Œæ¯”å¦‚ $2^4 &#x3D; 16$</li>
</ul>
<p><strong>ä½•æ—¶è¿™ä¸ªæ“ä½œç­‰äº 0 ï¼Ÿ</strong></p>
<p>æˆ‘ä»¬å¯ä»¥ä» oldCap å…¥æ‰‹ï¼Œå‡è®¾ oldCap æ˜¯ 16ï¼Œé‚£ä¹ˆå…¶äºŒè¿›åˆ¶ä¸º <code>10000</code></p>
<p>å¦‚æœæˆ‘ä»¬æƒ³ <code>e.hash &amp; oldCap</code> ç­‰äº 0ï¼Œé‚£ä¹ˆ<strong>è¯¥ Key çš„ hash å€¼çš„äºŒè¿›åˆ¶æœ€é«˜ä½å¿…é¡»ä¸º 0</strong>ï¼Œå‰©ä¸‹çš„äºŒè¿›åˆ¶ä½å¯ä»¥ä¸ç®¡ï¼Œè¿™æ ·è¿›è¡Œä¸è¿ç®—åçš„ç»“æœè‚¯å®šæ˜¯<strong>ç­‰äº</strong> 0 çš„ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æ­¤æ—¶ hash å€¼å¯¹åº”çš„äºŒè¿›åˆ¶ä¸º <code>01111</code>ï¼Œé‚£ä¹ˆå’Œ oldCap è¿›è¡Œä¸è¿ç®—ï¼š</p>
<p>&#96;&#96;e.hash &amp; oldCap<code>=</code>10000 &amp; 01111&#96; &#x3D; 00000 &#x3D; 0</p>
<p>æ˜¾è€Œæ˜“è§ï¼Œå½“ hash å€¼äºŒè¿›åˆ¶çš„æœ€é«˜ä½ä¸º 0 çš„æ—¶å€™ï¼Œå’Œ oldCap è¿›è¡Œä¸è¿ç®—åï¼Œç»“æœå¿…å®šä¸º0</p>
<p><strong>ä½†æ˜¯è¿™ä¸ªå’Œæ‰©å®¹åä½ç½®æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</strong>æˆ‘ä»¬çŸ¥é“ï¼Œæ‰©å®¹æ˜¯æ‰©ä¸ºåŸæ¥çš„ä¸¤å€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ï¼Œè®¡ç®—æ‰©å®¹åè¯¥Node èŠ‚ç‚¹åº”è¯¥åœ¨å“ªä¸ªæ–°ä½ç½®ã€‚</p>
<p>è®¡ç®—æ‰©å®¹åçš„ä½ç½®ï¼Œæˆ‘ä»¬çŸ¥é“æ˜¯è¿™æ ·çš„ï¼Œã€Œhash å€¼ &amp; æ•°ç»„é•¿åº¦å‡ä¸€ã€çš„è¿ç®—ç»“æœï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„æ•°ç»„ä¸‹æ ‡ã€‚</p>
<p>æ‰©å®¹åçš„åº”è¯¥åœ¨çš„ä½ç½®ï¼ˆoldCap æ˜¯ 16ï¼Œ2 å€å°±æ˜¯32ï¼Œ32 å¯¹åº”äºŒè¿›åˆ¶ 100000ï¼Œå‡ä¸€æ“ä½œåä¸º 011111ï¼‰ï¼š</p>
<p><code>hash &amp; 2 Ã— oldCap - 1</code> &#x3D; <code>01111 &amp; 011111</code> &#x3D; <code>01111</code></p>
<p>é‚£æ²¡æ‰©å®¹ä¹‹å‰çš„ä½ç½®åœ¨é‚£é‡Œï¼Ÿæˆ‘ä»¬è®¡ç®—ä¸‹ï¼š</p>
<p><code>hash &amp; oldCap - 1</code> &#x3D; <code>01111 &amp; 01111</code> &#x3D; <code>01111</code></p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ­¤æ—¶æ‰©å®¹åå’Œæ‰©å®¹å‰ï¼Œè¯¥å…ƒç´ çš„ä½ç½®æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚ å› æ­¤ï¼Œæ‰æœ‰è¿™ä¸ªç»“è®ºï¼š<strong>è¿ç®—ç»“æœä¸º 0 çš„è¯ï¼Œé‚£ä¹ˆæ”¾å…¥æ–°æ•°ç»„çš„ä½ç½®å’ŒåŸæ•°ç»„çš„ä½ç½®æ˜¯ä¸€æ ·çš„</strong>ã€‚</p>
<p><strong>ä½•æ—¶è¿™ä¸ªæ“ä½œä¸ç­‰äº 0 ï¼Ÿ</strong></p>
<p>åŒæ ·ï¼Œä» oldCap å…¥æ‰‹ï¼Œå‡è®¾æ­¤æ—¶ oldCap æ˜¯16ï¼Œå¯¹åº”äºŒè¿›åˆ¶ä¸º <code>10000</code></p>
<p>å¦‚æœæˆ‘ä»¬æƒ³ <code>e.hash &amp; oldCap</code> ä¸ç­‰äº 0ï¼Œé‚£ä¹ˆ<strong>è¯¥ Key çš„ hash å€¼çš„äºŒè¿›åˆ¶æœ€é«˜ä½å¿…é¡»ä¸º 1</strong>ï¼Œå‰©ä¸‹çš„äºŒè¿›åˆ¶ä½å¯ä»¥ä¸ç®¡ï¼Œè¿™æ ·è¿›è¡Œä¸è¿ç®—åçš„ç»“æœè‚¯å®šæ˜¯<strong>ä¸ç­‰äº</strong> 0 çš„ã€‚</p>
<p>è¿˜æ˜¯ä¸€æ ·ï¼Œä¸¾ä¾‹å­ï¼Œå‡è®¾ hash å€¼å¯¹åº”çš„äºŒè¿›åˆ¶ä¸º <code>10001</code>ï¼Œé‚£ä¹ˆå’Œ oldCap è¿›è¡Œä¸è¿ç®—ï¼š</p>
<p><code>e.hash &amp; oldCap</code> &#x3D; <code>10001 &amp; 10000</code> &#x3D; 10000 &#x3D; 16 â‰  0</p>
<p>æ˜¾è€Œæ˜“è§ï¼Œhash å€¼äºŒè¿›åˆ¶çš„æœ€é«˜ä½ä¸º 1ï¼Œé‚£ä¹ˆè¯¥ç»“æœå¿…å®šä¸ä¸º 0</p>
<p><strong>åŒç†ï¼Œæ¥çœ‹ä¸‹æ‰©å®¹å‰åçš„ä½ç½®å…³ç³»ã€‚</strong></p>
<p>æ‰©å®¹å‰çš„ä½ç½®ï¼š</p>
<p><code>hash &amp; oldCap - 1</code> &#x3D; <code>10001 &amp; 01111</code> &#x3D; <code>00001</code> &#x3D; 1 </p>
<p>æ‰©å®¹åçš„ä½ç½®ï¼š</p>
<p><code>hash &amp; 2 Ã— oldCap - 1</code> &#x3D; <code>10001 &amp; 011111</code> &#x3D; <code>10001</code> &#x3D; 17</p>
<p>å®ƒä»¬ä¹‹é—´æœ‰ä¸€ç§å·§å¦™çš„å…³ç³»ï¼Œå°±æ˜¯ï¼šã€Œæ‰©å®¹åçš„ä½ç½®ã€ä¼šç­‰äºã€Œæ‰©å®¹å‰çš„ä½ç½®ã€åŠ ä¸Šã€Œæ‰©å®¹å‰çš„æ•°ç»„å®¹é‡ã€ï¼Œä¹Ÿå°±æ˜¯è¯´ <code>10001(æ‰©å®¹åçš„ä½ç½®) = 1(æ‰©å®¹å‰çš„ä½ç½®) + 10000(æ‰©å®¹å‰çš„æ•°ç»„å®¹é‡ï¼Œ16)</code></p>
<p>æ‰€ä»¥ï¼Œæ‰æœ‰è¿™ä¸ªç»“è®ºï¼š<strong>è¿ç®—ç»“æœä¸ä¸º 0 çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦é‡æ–°è®¡ç®—ä½ç½®ï¼ˆæ–°ä½ç½®ï¼šæ‰€åœ¨çš„åŸæ•°ç»„ä½ç½®ä¸‹æ ‡åŠ ä¸ŠåŸæ•°ç»„å®¹é‡ï¼ˆé•¿åº¦ï¼‰ï¼‰</strong>ã€‚</p>
<h3 id="å…³äºçº¢é»‘æ ‘"><a href="#å…³äºçº¢é»‘æ ‘" class="headerlink" title="å…³äºçº¢é»‘æ ‘"></a>å…³äºçº¢é»‘æ ‘</h3><p>å¾…å®Œå–„ï¼Œç­‰ç€å¡«å‘ã€‚</p>
<h3 id="1-8-æ€»ç»“"><a href="#1-8-æ€»ç»“" class="headerlink" title="1.8 æ€»ç»“"></a>1.8 æ€»ç»“</h3><p>åœ¨ 1.8 çš„ HashMapä¸­ï¼Œåº•å±‚æ˜¯ Node ç±»å‹çš„æ•°ç»„ + Node ç±»å‹çš„é“¾è¡¨ æˆ–è€… + Node ç±»å‹çš„çº¢é»‘æ ‘ã€‚</p>
<p>æ¯”èµ· 1.7 æ¥è¯´ï¼Œå˜åŒ–è¿˜æ˜¯æŒºå¤šçš„ï¼Œæºç çš„å†™æ³•ä¹Ÿå˜å¾—æ›´åŠ é«˜çº§ï¼Œå½“ç„¶æ•ˆç‡ä¹Ÿå˜å¾—æ›´é«˜äº†ï¼Œå¼•å…¥äº†çº¢é»‘æ ‘æé«˜æŸ¥æ‰¾æ•ˆç‡ã€‚å› ä¸ºå¼•å…¥äº†çº¢é»‘æ ‘ï¼Œæ‰€ä»¥è§£å†³å†²çªçš„æ—¶å€™ï¼Œå°±æœ‰äº›åŒºåˆ«äº†ã€‚</p>
<p>å¦‚æœå½“è¦å­˜å‚¨çš„ Key-Value çš„ Key ä¸å½“å‰ä½ç½®ä¸Šçš„ Key å‘ç”Ÿå†²çªï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œå°¾æ’æ³•ï¼ˆ1.7 å°±æ˜¯å¤´æ’æ³•ï¼‰ï¼Œå°†è¯¥ Key æ’å…¥å½“å‰å“ˆå¸Œæ¡¶å¯¹åº”çš„é“¾è¡¨ï¼Œå½“è¿™ä¸ªé“¾è¡¨çš„é•¿åº¦å¤§äº 8 ä¸”æ•°ç»„é•¿åº¦å¤§äºç­‰äº 64 æ—¶ï¼Œå½“å‰é“¾è¡¨å°±ä¼šæ ‘åŒ–ï¼Œè½¬æˆçº¢é»‘æ ‘ï¼Œå½“çº¢é»‘æ ‘ä¸­çš„å…ƒç´ å°äº 6 æ—¶ï¼Œé‚£ä¹ˆå°±ä¼šé€€åŒ–å›æ¥æˆä¸ºé“¾è¡¨ã€‚å¦‚æœä»…ä»…é“¾è¡¨é•¿åº¦å¤§äº 8ï¼Œä½†æ˜¯æ•°ç»„é•¿åº¦å°äº 64ï¼Œé‚£ä¹ˆå°±åªä¼šè¿›è¡Œæ‰©å®¹ï¼Œä¸ä¼šæŠŠé“¾è¡¨æ ‘åŒ–ï¼ˆè¿™éƒ¨åˆ†çš„æºç åœ¨ <code>treeifyBin()</code> æ–¹æ³•ä¸­ï¼‰ã€‚</p>
<h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>ä»¥ä¸Šï¼Œå°±æ˜¯æµ…å…¥æµ…å‡º 1.7 å’Œ 1.8 çš„ HashMapï¼</p>
</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="Donate" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">é“ä»”oré“å¥³ï¼Œå¯ä»¥è¯·æˆ‘å–æ¯å’–å•¡å—ï¼Ÿ.</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://pic-bed-of-god23bin.oss-cn-shenzhen.aliyuncs.com/img/20220523221203.png"><img loading="lazy" src="https://pic-bed-of-god23bin.oss-cn-shenzhen.aliyuncs.com/img/20220523221203.png" alt="æ”¯ä»˜å®" title="æ”¯ä»˜å®"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://pic-bed-of-god23bin.oss-cn-shenzhen.aliyuncs.com/img/20220523221130.png"><img loading="lazy" src="https://pic-bed-of-god23bin.oss-cn-shenzhen.aliyuncs.com/img/20220523221130.png" alt="å¾®ä¿¡æ”¯ä»˜" title="å¾®ä¿¡æ”¯ä»˜"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>god23bin</li><li class="post-copyright-link"><strong>Post link: </strong><a href="https://god23bin.github.io/posts/shallow-in-java-with-hashmap/" title="æ·±å…¥æµ…å‡º1.7å’Œ1.8çš„HashMap">https://god23bin.github.io/posts/shallow-in-java-with-hashmap/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless otherwise stated.</li></ul><script>document.addEventListener('copy', function (event) {
  const clipboardData = event.clipboardData || window.clipboardData;
  if (!clipboardData) { return; }
  const text = window.getSelection().toString();
  if (text) {
    event.preventDefault();
    clipboardData.setData('text/plain', text + '\n\nPost author: god23bin\nPost link: https://god23bin.github.io/posts/shallow-in-java-with-hashmap/\nCopyright Notice: All articles in this blog are licensed under CC BY-NC-SA 4.0 unless otherwise stated.');
  }
});</script></article><div class="post-nav"><div class="post-nav-item"></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/I-can-finally-write-scheduled-tasks-in-Java/" rel="next" title="æˆ‘ç»ˆäºä¼šå†™ Java çš„å®šæ—¶ä»»åŠ¡äº†ï¼"><span class="post-nav-text">æˆ‘ç»ˆäºä¼šå†™ Java çš„å®šæ—¶ä»»åŠ¡äº†ï¼</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2021 â€“ 2022 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> god23bin</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v6.1.0</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.8.11</span></div><div class="live-time"><span>æœ¬åšå®¢å·²èŒèŒå“’åœ°è¿è¡Œ</span><span id="display_live_time"></span><span class="moe-text">(â—'â—¡'â—)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2021-04-01T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = ` ${passDay} Days ${passHour} Hours ${passMinute} Minutes ${passSecond} Seconds`;
}
blog_live_time();
</script></div><div id="busuanzi"><span id="busuanzi_container_site_uv" title="Total Visitors"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-user-line"></use></svg></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="Total Views"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg></span><span id="busuanzi_value_site_pv"></span></span><script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#6200ee" stroke-width="2" stroke-linecap="round"></circle></svg></a><script>function initMourn() {
  const date = new Date();
  const today = (date.getMonth() + 1) + "-" + date.getDate()
  const mourn_days = ["4-4","9-18"]
  if (mourn_days.includes(today)) {
    document.documentElement.style.filter = "grayscale(1)";
  }
}
initMourn();</script><div class="aplayer no-destroy" id="aplayer" data-id="140834718" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay data-theme="#6200ee" data-loop="all" data-order="list" data-preload="auto" data-volume="0.7" data-mutex data-lrctype="0" data-listmaxheight="340px" data-storagename="metingjs"></div></div></body></html>